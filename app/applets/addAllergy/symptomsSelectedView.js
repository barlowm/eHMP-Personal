define(["backbone","marionette","underscore","moment","hbs!app/applets/addAllergy/templates/symptomsSelectedViewTemplate","app/applets/addAllergy/utils/symptomsUtil","app/applets/addAllergy/utils/allergiesUtil","app/applets/addAllergy/addAllergyGlobals","app/applets/addAllergy/utils/modelBindingUtil","app/applets/addAllergy/models/symptomsModel"],function(e,t,i,s,l,o,n,a,m,d){var p=e.Marionette.ItemView.extend(m).extend({template:l,tagName:"tr",className:"",model:d,initialize:function(){this.initializeBinding(),this.listenTo(this.model,"change",function(){var e=!this.model.get("symptomDate"),t=this.$(".timepicker input");e&&t.val("").change(),t.prop("disabled",e)},this)},attributes:function(){return{id:"symptom^"+this.model.get("IEN")+"^"+this.model.get("name")}},onRender:function(){var e=(new Date,"dp-"+this.model.get("count")+"-"+this.model.get("IEN")),t=this.$("#"+e);ADK.utils.dateUtils.datepicker(t,{endDate:(new s).format(ADK.utils.dateUtils.defaultOptions().placeholder)}),t.parent().find(".glyphicon-calendar").on("click",function(){t.datepicker("show")});var i="tp-"+this.model.get("count")+"-"+this.model.get("IEN"),l=this.$("#"+i);l.inputmask("Regex",{placeholder:"hh:mm a/p",clearIncomplete:!0,onincomplete:function(e){$(this).val("").trigger("change")}})},modelEvents:{"change:symptomDate":"setDateTime","change:symptomTime":"setDateTime"},events:{"click .xbutton":"removeSymptom","keydown .xbutton":"removeSymptomKeyEvent","keyup .date > input":"datepickerKeyDownEvent","focus .date > input":"datepickerFocusEvent","change .date > input":function(){this.model.set({symptomDate:this.$el.find("#dp-"+this.model.get("count")+"-"+this.model.get("IEN")).val()})},"change .timepicker":function(){this.model.set({symptomTime:this.$el.find("#tp-"+this.model.get("count")+"-"+this.model.get("IEN")).val()})}},setDateTime:function(e){var t=this.model.get("symptomTime"),i=this.model.get("symptomDate"),s="";s=t?ADK.utils.dateUtils.getRdkDateTimeFormatter().getDateTimeFromDateTimeStrings(i,t):ADK.utils.dateUtils.getRdkDateTimeFormatter().getDateFromDateString(i),"Invalid date"===s&&(s=""),this.model.set("dateTime",s)},removeSymptom:function(e){var t,i=$(":focus").parent().parent().parent().parent().parent().parent(),s=$("#symptoms-selected-tbl > tbody").children().eq(0),l="symptom^"+this.model.get("IEN")+"^"+this.model.get("name"),o=$(i,$("#symptoms-selected-tbl > tbody")).index();return t=1===$("#symptoms-selected-tbl > tbody").children().length?$("#symptoms-ul:first > li:first > a"):$("#symptoms-selected-tbl > tbody").children().length>1&&l===s.attr("id")?$("#symptoms-selected-tbl > tbody"):$("#symptoms-selected-tbl > tbody").children().eq(o-1),this.model.set("focusElement",t),a.addAllergyApplication.vent.trigger(a.events.REMOVE_SYMPTOMS,this.model),this.remove(),!1},removeSymptomKeyEvent:function(e){(13===e.keyCode||32===e.keyCode)&&(e.preventDefault(),this.removeSymptom())},datepickerKeyDownEvent:function(e){var t=$("#symptoms-selected-tbl > tbody").children().eq(0),i="symptom^"+this.model.get("IEN")+"^"+this.model.get("name");9===e.keyCode&&e.shiftKey&&i===t.attr("id")&&(e.preventDefault(),o.isSymptomsListEmpty()?$("#symptomSearchInput").focus():($("#symptoms-ul:first > li:first > a").focus(),$("#symptomsList").scrollTop(0)))},datepickerFocusEvent:function(e){$(".errorMessage").remove(),$(e.target).val(n.currentObservedDateString())}}),r=e.Marionette.CollectionView.extend({initialize:function(){var e=this;a.addAllergyApplication.vent.on(a.events.ADD_SYMPTOMS,function(t){e.collection.add(new d(t.attributes))}),a.addAllergyApplication.vent.on(a.events.REMOVE_SYMPTOMS,function(t){e.collection.remove(t)})},childView:p,tagName:"table",className:"table table-condensed table-striped table-hover",id:"symptoms-selected-tbl",attributes:{width:"250"}});return r});
define(["underscore","moment","app/applets/addAllergy/utils/validation","app/applets/addAllergy/models/symptomsCollection"],function(e,t,r,i){"use strict";var a,n=Backbone.Model.extend(r).extend({initialize:function(){this.initializeValidation(),this.get("param").symptoms.on("all",function(){this.validateModel(this),this.trigger("change",this)},this)},urlRoot:function(){var e=ADK.PatientRecordService.getCurrentPatient();return ADK.ResourceService.buildUrl("write-back-save-allergy",{pid:e.get("icn")||e.get("pid")||e.get("id")})},defaults:function(){return a=ADK.UserService.getUserSession(),{originatorName:a.get("firstname")+" "+a.get("lastname"),historicalOrObserved:"",nature:"","obs-date":"","obs-time":"",param:{localId:ADK.PatientRecordService.getCurrentPatient().get("localId"),allergyName:"",natureOfReaction:"",cmtText:"",symptoms:new i,severity:"",eventDateTime:""}}},validation:{historicalOrObserved:{required:!0},"obs-date":{message:"Please enter a valid date.",fn:function(e,t){if("h^HISTORICAL"===t.get("historicalOrObserved"))return!0;var r=ADK.utils.formatDate(e,ADK.utils.dateUtils.defaultOptions().format,ADK.utils.dateUtils.defaultOptions().placeholder),i=-53646624e5,a=e.match(ADK.utils.dateUtils.defaultOptions().regex)||[];return r&&(Date.parse(r)<i||a.length<1||a[0]!==e)?!1:!0},required:{message:"",fn:function(e,t){return"o^OBSERVED"!==t.get("historicalOrObserved")||e?!0:!1}}},"obs-time":{message:"Future time not allowed",fn:function(e,r){if("h^HISTORICAL"===r.get("historicalOrObserved")||0===e.length)return!0;var i=new t(r.get("obs-date")+" "+e+"m");return i.isAfter(new t)?!1:!0}},nature:{required:!0},"param.severity":{required:{fn:function(e,t){return"o^OBSERVED"!==t.get("historicalOrObserved")||e?!0:!1}}},"param.symptoms":{required:{fn:function(e,t){return"o^OBSERVED"===t.get("historicalOrObserved")&&0===e.length?!1:!0}}}}});return n});
define(["backbone","app/applets/activeMeds/medicationCollectionHandler"],function(e,i){var t={fetchOptions:{resourceTitle:"patient-record-med",cache:!0,viewModel:{parse:function(e){var i=ADK.utils.getTimeSince(e.lastAction);return e.age=e.lastAction,e.ageDescription=i.timeSinceDescription,e}},pageable:!1,criteria:{filter:""}},transformCollection:function(t){if(t.models.length>0&&void 0!==t.models[0].get("meds"))return t;var a=e.Model.extend({}),l=t.groupBy(function(e){return i.getActiveMedicationGroupbyData(e).groupbyValue}),n=_.map(l,function(e,i){return new a({groupName:i,normalizedName:e[0].get("normalizedName"),meds:e,sig:e[0].get("sig"),facilityDisplay:e[0].get("facilityName"),uid:e[0].get("uid"),lastAction:e[0].get("lastAction"),age:e[0].get("age"),ageReadText:e[0].get("ageDescription"),calculatedStatus:e[0].get("calculatedStatus"),orders:e[0].get("orders"),applet_id:"activeMeds"})});return _.each(n,function(e){i.afterGroupingParse(e.attributes)}),t.reset(n),t},gistHeaders:{name:{title:"Medication",sortable:!0,sortType:"alphabetical",key:"normalizedName",hoverTip:"medications_medication"},description:{title:"",sortable:!1},graphic:{title:"Change",sortable:!0,sortType:"alphabetical",key:"doseChange",hoverTip:"medications_change"},count:{title:"Refills",sortable:!0,sortType:"numeric",key:"totalFillsRemaining",hoverTip:"medications_refills"}},gistModel:[{id:"id",field:"groupName"},{id:"name",field:"normalizedName"},{id:"description",field:"sig"},{id:"age",field:"age"},{id:"ageReadText",field:"ageReadText"},{id:"graphic",field:"doseChange"},{id:"count",field:"totalFillsRemaining"}],filterFields:["normalizedName","age","totalFillsRemaining","sig"]};return t});
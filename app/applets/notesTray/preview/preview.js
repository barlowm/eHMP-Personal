define(["backbone","marionette","underscore","hbs!app/applets/notesTray/preview/notePreviewTemplate"],function(e,t,n,i){"use strict";var s=ADK.Messaging.getChannel("notesTray"),o=e.Marionette.ItemView.extend({template:i,events:{"click #note-preview-edit-btn":"showEditForm",keyup:function(e){27===e.keyCode&&this.triggerClose(e)}},initialize:function(e){var t=e.model.get("encounterName"),n=null,i=null,s=null,o=null;t&&(t.length>16&&(o=t.substring(t.length-16),3===o.split("/").length&&(i=t.substring(0,t.length-16),s=moment(o,"MM/DD/YYYY HH:mm").format("MM/DD/YYYY"),n=i.trim()+": "+s)),!n&&t.length>12&&(i=t.substring(0,t.length-12),o=t.substring(t.length-12),s=moment(o,"MMM DD, YYYY").format("MM/DD/YYYY"),n=i.trim()+": "+s)),n||(n=t),e.model.set("encounterDisplayName",n)},onRender:function(){this.setButtonVisibility()},setButtonVisibility:function(e){("vista"===this.model.get("app").toLowerCase()||"completed"===this.model.get("status").toLowerCase())&&this.$("#note-preview-edit-btn").addClass("hidden")},triggerClose:function(e){e.preventDefault(),ADK.Messaging.getChannel("notesTray").trigger("close:preview",this.model),this.trigger("close")},showEditForm:function(e){e.preventDefault(),s.trigger("close:preview",this.model),this.trigger("close"),s.trigger("editNote-btn",this.model)}});return o});
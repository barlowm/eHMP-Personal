define(["backbone","marionette","app/applets/ccd_grid/util","app/applets/ccd_grid/modal/modalView","app/applets/ccd_grid/modal/modalHeaderView","hbs!app/applets/ccd_grid/list/dateCellTemplate","hbs!app/applets/ccd_grid/list/dateTimeCellTemplate"],function(e,t,i,a,n,r,l){"use strict";var o,c={name:"referenceDateTimeDisplay",label:"Date",cell:"string",sortValue:function(e,t){return e.get("referenceDateTime")},hoverTip:"chs_date"},s={name:"referenceDateDisplay",label:"Date",cell:"string",sortValue:function(e,t){return e.get("referenceDateTime")},hoverTip:"chs_date"},p={name:"authorDisplayName",label:"Authoring Institution",cell:"string",hoverTip:"chs_authoringinstitution"},d={name:"summary",label:"Description",cell:"string",hoverTip:"chs_description"},m=[s,p],u=[c,d,p],D={parse:function(e){return e.name&&(e.localTitle=e.name),e.creationTime?e.referenceDateTime=e.creationTime:e.dateTime&&(e.referenceDateTime=e.dateTime),e.referenceDateDisplay=ADK.utils.formatDate(e.referenceDateTime),""===e.referenceDateDisplay&&(e.referenceDateDisplay="N/A"),e.referenceDateTimeDisplay=ADK.utils.formatDate(e.referenceDateTime,"MM/DD/YYYY - HH:mm"),""===e.referenceDateTimeDisplay&&(e.referenceDateTimeDisplay="N/A"),e.authorList&&(e.authorList.length>0?e.authorList[0].institution&&(e.authorDisplayName=e.authorList[0].institution):e.authorDisplayName="N/A"),e.facilityName="VLER",e}},h={resourceTitle:"patient-record-vlerdocument",pageable:!0,viewModel:D,cache:!0,criteria:{callType:"vler_list"}},f=ADK.Applets.BaseGridApplet,g=f.extend({initialize:function(e){o=f.prototype;var t={};t.filterEnabled=!0,"summary"===this.columnsViewType?t.columns=m:"expanded"===this.columnsViewType?t.columns=u:(t.summaryColumns=m,t.fullScreenColumns=u),t.enableModal=!0;var r=this;this.dataGridOptions=t,t.collection=ADK.PatientRecordService.fetchCollection(h),t.onClickRow=function(e,r,l){r.preventDefault();var o=new a({model:e,target:r.currentTarget,collection:t.collection,initCount:0}),c={title:i.getModalTitle(e),size:"xlarge",headerView:n.extend({model:e,theView:o,initCount:0})},s=new ADK.UI.Modal({view:o,options:c});s.show()},o.initialize.apply(this,arguments);var l=ADK.Messaging.getChannel("ccd_grid");l.reply("gridCollection",function(){return r.gridCollection})},onBeforeDestroy:function(){var e=ADK.Messaging.getChannel("ccd_grid");e.stopReplying("gridCollection"),this.dataGridOptions.onClickRow=null},onRender:function(){o.onRender.apply(this,arguments)}}),y={id:"ccd_grid",viewTypes:[{type:"summary",view:g.extend({columnsViewType:"summary"}),chromeEnabled:!0},{type:"expanded",view:g.extend({columnsViewType:"expanded"}),chromeEnabled:!0}],defaultViewType:"summary"},T=ADK.Messaging.getChannel(y.id);return T.reply("detailView",function(t){var n={criteria:{uid:t.uid},patient:new e.Model({icn:t.patient.icn,pid:t.patient.pid}),resourceTitle:"patient-record-vlerdocument",viewModel:D},r=$.Deferred(),l=ADK.PatientRecordService.fetchCollection(n);return l.on("sync",function(){var e=l.first();r.resolve({view:new a({model:e}),title:i.getModalTitle(e)})},this),r.promise()}),y});
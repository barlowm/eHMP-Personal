define(["backbone","marionette","hbs!app/applets/medication_review_v2/templates/medicationTemplate","app/applets/medication_review_v2/views/orderDetailView","hbs!app/applets/medication_review_v2/templates/orderHistoryTemplate","hbs!app/applets/medication_review_v2/templates/infoButtonTemplate","hbs!app/applets/medication_review_v2/templates/infoButtonTemplate2","hbs!app/applets/medication_review_v2/templates/infoButtonPatientTemplate","app/applets/medication_review_v2/appletHelper"],function(e,t,i,n,o,a,s,r,l){var d=e.Marionette.ItemView.extend({template:o,tagName:"li",className:"order-dates-range",attributes:{role:"listitem"},initialize:function(e){this.parentView=e.parent},events:{click:"updateDetailView","click .order-dates":"selectOrder","keydown .order-dates":"onEnter"},updateDetailView:function(e){e.preventDefault(),this.parentView.updateDetailView(this.model),this.selectOrder()},selectOrder:function(){$(this.parentView.$el).find(".selectedOrder").removeClass("selectedOrder"),$(this.$el).addClass("selectedOrder")},onEnter:function(e){(13==e.which||32==e.which)&&$(e.target).click()}}),c=e.Marionette.CollectionView.extend({tagName:"ul",attributes:{role:"list"},initialize:function(e){this.parent=e.parentLayoutView},className:"orders-links-list",childView:d,childViewOptions:function(){return{parent:this.parent}},onRender:function(){$(this.$el).find("li").first().addClass("selectedOrder")}}),u=e.Model.extend({defaults:{url:""},parse:function(e){return e}}),h=new u({}),p=e.Marionette.ItemView.extend({onRender:function(){}}),m=e.Model.extend({defaults:{url:""},parse:function(e){return e}}),f=e.Marionette.ItemView.extend({onRender:function(){}}),w=new m({}),V=e.Marionette.LayoutView.extend({initialize:function(){this._super=e.Marionette.LayoutView.prototype,this.model.get("submeds")?this.collection=this.model.get("submeds"):this.collection=this.model.get("meds"),this.orderHistoryListView=new c({collection:this.collection,parentLayoutView:this}),this.orderDetailView=new n({model:this.collection.models[0]});var t=ADK.UserService.getUserSession(),i=t.get("infoButtonOid");"1.3.6.1.4.1.3768"==i?(this.infoButtonView=new p({model:h,template:a}),this.infoButtonPatientView=new f({model:w,template:r})):void 0===i?(i="1.3.6.1.4.1.3768",this.infoButtonView=new p({model:h,template:a}),this.infoButtonPatientView=new f({model:w,template:r})):(this.infoButtonView=new p({model:h,template:s}),this.infoButtonPatientView=new f({model:w,template:s}));var o=this.orderDetailView.model.get("name"),l=o.search(/,|[0-9]/);for(l>0&&(o=o.substr(0,l)),l=o.search(" tab"),-1!=l&&(o=o.substr(0,l)),l=o.search(" cap"),-1!=l&&(o=o.substr(0,l)),l=o.search(" inj"),-1!=l&&(o=o.substr(0,l)),l=o.search(" soln"),-1!=l&&(o=o.substr(0,l)),l=o.search(" aerosol"),-1!=l&&(o=o.substr(0,l)),l=o.search(" drip"),-1!=l&&(o=o.substr(0,l)),l=o.search(" oral"),-1!=l&&(o=o.substr(0,l));-1!=o.search(" ");)o=o.replace(" ","%20");var d="/infobutton-service/infoRequest?representedOrganization.id.root="+i;d+="&taskContext.c.c=MLREV",d+="&mainSearchCriteria.v.dn=",d+=o,d+="&informationRecipient=PROV",d+="&informationRecipient.languageCode.c=en",d+="&performer=healthcareProvider",d+="&xsltTransform=Infobutton_UI_VA";var u="/infobutton-service/infoRequest?representedOrganization.id.root="+i;u+="&taskContext.c.c=MLREV",u+="&mainSearchCriteria.v.dn=",u+=o,u+="&informationRecipient=PAT",u+="&informationRecipient.languageCode.c=en",u+="&performer=healthcareProvider",u+="&xsltTransform=Infobutton_UI_VA";var m=[],V=[];m[0]="http://clinicalpharmacology-ip.com/Forms/search.aspx?s="+o,V[0]="Clinical Pharmacology",m[1]="http://home.mdconsult.com/public/search?mdcquery="+o,V[1]="MDConsult",m[2]="http://www.uptodate.com/online/content/search.do?",m[2]+="searchType=HL7&amp;taskContext.c.c=MLREV&amp;taskContext.c.cs=2.16.840.1.113883.5.4",m[2]+="&amp;mainSearchCriteria.v.dn="+o,V[2]="UpToDate",m[3]="http://www.visualdx.com/visualdx/visualdx6/infobutton.do?",m[3]+="taskContext.c.c=MLREV&taskContext.c.cs=2.16.840.1.113883.5.4",m[3]+="&mainSearchCriteria.v.dn="+o,V[3]="VisualDx",this.infoButtonView.model.set("openInfoButtonUrl1",m[0]),this.infoButtonView.model.set("openInfoButtonSiteName1",V[0]),this.infoButtonView.model.set("openInfoButtonUrl2",m[1]),this.infoButtonView.model.set("openInfoButtonSiteName2",V[1]),this.infoButtonView.model.set("openInfoButtonUrl3",m[2]),this.infoButtonView.model.set("openInfoButtonSiteName3",V[2]),this.infoButtonView.model.set("openInfoButtonUrl4",m[3]),this.infoButtonView.model.set("openInfoButtonSiteName4",V[3]);var v="http://infobutton.staywellsolutionsonline.com/infobuttonsearch.pg?";v+="mainSearchCriteria.v.dn="+o;var B="Krames StayWell";this.infoButtonPatientView.model.set("infoButtonPatientUrl1",v),this.infoButtonPatientView.model.set("infoButtonPatientSiteName1",B),this.infoButtonPatientView.model.set("infoButtonPatientUrl2",m[2]),this.infoButtonPatientView.model.set("infoButtonPatientSiteName2",V[2]),this.infoButtonPatientView.model.set("infoButtonPatientUrl3",m[3]),this.infoButtonPatientView.model.set("infoButtonPatientSiteName3",V[3]),this.model.set("activeCount",this.countMedStatus(this.collection,"ACTIVE")),this.model.set("pendingCount",this.countMedStatus(this.collection,"PENDING"))},templateHelpers:{isNonVa:function(){return"N"===this.vaType?!0:!1},isNotDiscontinued:function(){return"DISCONTINUED"!==this.vaStatus?!0:!1}},countMedStatus:function(e,t){var i=0;return e.forEach(function(e){e.get("standardizedVaStatus").toUpperCase()===t&&i++}),i>1?i:null},onRender:function(){this.orderHistoryRegion.show(this.orderHistoryListView),this.orderDetailRegion.show(this.orderDetailView),this.infoButtonRegion.show(this.infoButtonView),this.infoButtonPatientRegion.show(this.infoButtonPatientView)},updateDetailView:function(e){this.orderDetailView.model=e,this.orderDetailView.render(),this.showHideDiscontiueBtn(e)},launchDiscontinueNonVaMedModal:function(e){e.preventDefault();var t=ADK.Messaging.getChannel("medicationChannel");t.trigger("discontinueNonVaMed:clicked",e,this.orderDetailView.model)},launchEditNonVaMedModal:function(e){e.preventDefault();var t=ADK.Messaging.getChannel("medicationChannel");t.trigger("editNonVaMed:clicked",e,this.orderDetailView.model)},onOrderNavKeyDown:function(e){(13===e.which||32===e.which)&&$(e.target).click()},showHideDiscontiueBtn:function(e){"DISCONTINUED"===e.get("vaStatus")?$("#discontinue").hide():$("#discontinue").show()},template:i,regions:{orderHistoryRegion:"#order-history-panel",orderDetailRegion:"#order-detail-panel",infoButtonRegion:"#info-button-panel",infoButtonPatientRegion:"#info-button-patient-panel"},events:{"click #discontinue":"launchDiscontinueNonVaMedModal","click #edit":"launchEditNonVaMedModal","keydown .orderNav":"onOrderNavKeyDown"}});return V});
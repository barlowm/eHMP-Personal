define(["app/applets/medication_review_v2/medicationCollectionHandler","hbs!app/applets/medication_review_v2/templates/appletLayout","app/applets/medication_review_v2/views/medicationListView"],function(e,t,i){var o=Backbone.Marionette.CompositeView.extend({template:t,childView:i,childViewContainer:"#medsReviewApplet_mainContentArea",initialize:function(e){this._super=Backbone.Marionette.CompositeView.prototype,this.collection=e.collection,this._super.initialize.apply(this,arguments)},onRender:function(){var e=$('[data-appletid="medication_review_v2"]').attr("data-instanceid"),t=$("#"+e).height()-30;$('[data-appletid="medication_review_v2"]').find(".grid-container").height(t.toString()+"px")}}),l=ADK.Applets.BaseDisplayApplet.extend({initialize:function(t){var i=this;this._super=ADK.Applets.BaseDisplayApplet.prototype,this.appletOptions={collection:e.fetchAllMeds(!0),AppletView:o,filterFields:["name","sig","standardizedVaStatus","drugClassName"]},this.$el.addClass("gridster"),this.listenTo(ADK.Messaging,"globalDate:selected",function(e){i.dateRangeRefresh()}),this.listenTo(this.appletOptions.collection,"customfilter",this.onCustomFilter),this.listenTo(this.appletOptions.collection,"clear_customfilter",this.onClearCustomFilter),this._super.initialize.apply(this,arguments)},dateRangeRefresh:function(){this.loading();this.appletOptions.collection;this.loading(),this.displayAppletView=new this.appletOptions.AppletView(this.appletOptions),this.appletOptions.collection instanceof Backbone.PageableCollection?this.appletOptions.collection.fullCollection.reset():this.appletOptions.collection.reset(),ADK.ResourceService.fetchCollection(this.appletOptions.collection.fetchOptions,this.appletOptions.collection)},onCustomFilter:function(t){if(void 0!==e.shadowCollection){var i=this,o=e.shadowCollection.filter(function(e){var o="";return _.each(i.appletOptions.filterFields,function(t){if("drugClassName"===t)for(var i=void 0!==e.get("products")?e.get("products").length:0,l=0;i>l;l++)void 0!==e.get("products")[l].drugClassName&&(o=o+" "+e.get("products")[l].drugClassName);else o=o+" "+e.get(t)}),t.test(o)}),l=new Backbone.Collection;l.reset(o);var s=e.groupCollectionModels(l);this.appletOptions.collection.reset(s)}},onClearCustomFilter:function(t){var i=new Backbone.Collection;i.reset(e.shadowCollection.models);var o=e.groupCollectionModels(i);this.appletOptions.collection.reset(o),t&&this.onCustomFilter(t)}});return l});
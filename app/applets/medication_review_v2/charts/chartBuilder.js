define(["moment"],function(){function e(e,t){var a,i,r,o,n={chart:{},name:e.get("name"),xAxis:{gridLineColor:"$grey-dark",gridLineWidth:2,plotLines:[],labels:{enabled:!1}},yAxis:{categories:[{name:"",categories:[]}]},series:[{borderWidth:1,pointRange:6e4,data:[]},{borderWidth:1,pointRange:6e4,color:"rgba(1, 152, 117, 0.3)",data:[]}]},s=function(e){e.facilityModelCollection.sort(function(e,t){var a=new Date(e.get("overallStart")),i=new Date(t.get("overallStart"));return a-i})},l=function(e,t,a,i,r,o,s,l){n.series[o].data.push({borderWidth:3,borderColor:l,height:e,x:t,x2:a,y:r,color:i,facilityMoniker:s})},d=function(e,t,a){var i;return i=a>=e&&t>a?a:e},g=function(e,t,a){var i;return i=a>=e&&t>a?a:t},m="rgba(215, 215, 215, 1)",u="rgba(255, 255, 255, 1)",c="rgba(0, 153, 255, 0.5)",f={pattern:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAAP0lEQVQYV2O8fv36f2lpaQZ8gPHTp0//nz59yoBPIVgRyBR8CuGK8ClEUYRLIYYibAqxKkJXiFMRskK8imAKAVBiOjbe4KWvAAAAAElFTkSuQmCC",width:6,height:6},h=20,A=10,p=0,v=e.get("subMedsInternalGroupModels");if(t){var Y=ADK.SessionStorage.getModel_SessionStoragePreference("globalDate");i=moment(Y.get("fromDate"),"MM/DD/YYYY").valueOf(),r=moment(Y.get("toDate"),"MM/DD/YYYY").valueOf(),o=25}else i=e.get("graphRelativeityOldestTime"),r=e.get("graphRelativeityNewestTime"),o=23;n.chart.plotBackgroundColor="#F2F2F2",n.chart.height=o;for(var D=0;D<v.length;D++){var x=v.at(D),y=x.get("facilityMoniker"),M=x.get("facilityMeds");v.length>1&&(h=20,n.chart.height=o*v.length),M.comparator="stopped",s({facilityModelCollection:M});for(var S=0,b=1;S<M.length;S++){var O;k=moment(M.models[S].stopped,"YYYYMMDD"),O=_.isUndefined(M.models[b])?M.models[S].get("graphRelativeityNewestTime"):moment(M.models[b].get("overallStart"),"YYYYMMDD"),M.models[S].set("calculatedStopDate",O),b++}for(var C=0;C<M.length;C++){var R,k,w,L,B,K,V=M.at(C),I=V.get("uid");n.yAxis.categories[0].name=e.get("name"),n.yAxis.categories[0].categories.push(y),n.xAxis.min=i,n.xAxis.max=r,n.uid=I;var Q=(V.get("administrations"),V.get("fills")),T=V.get("dosages");if(T?n.instructions=T[0].instructions:n.instructions="--",L=V.get("standardizedVaStatus").toLowerCase(),R=moment(V.get("overallStart"),"YYYYMMDD").valueOf(),k=moment(V.get("stopped"),"YYYYMMDD").valueOf(),B=V.get("calculatedStopDate"),K=V.get("vaType"),"I"!==K&&"V"!==K&&R>0&&(moment(R).isSame(k)&&(k=moment(k).add(1,"minutes").valueOf()),moment(R).isBefore(k)||moment(R).isSame(k))){var U=moment(e.get("greenLineDate"),"YYYYMMDD").valueOf();if(n.xAxis.plotLines.push({color:"rgba(13, 131, 43, 0.7)",value:U,dashStyle:"solid",width:2,zIndex:5}),t||n.xAxis.plotLines.push({color:"#f20000",value:moment().valueOf(),dashStyle:"solid",width:1,zIndex:5}),"pending"===L)l(p,d(R,k,i),g(R,k,r),u,D,0,y,u);else if(l(h,d(R,k,i),g(R,k,r),u,D,0,y,u),"N"===K&&("discontinued"===L?l(A,d(R,k,i),g(R,k,r),c,D,1,y,c):"active"===L&&l(A,d(R,B,i),g(R,B,r),c,D,1,y,c)),moment(k).isBefore(B)&&("discontinued"===L?a=f:("active"===L||"expired"===L||"expires"===L)&&(a=m),l(h,d(k,B,i),g(k,B,r),a,D,0,y,a)),"O"===K&&Q)for(var E=0;E<Q.length;E++)if(!_.isUndefined(Q[E].releaseDate)&&!_.isEmpty(Q[E].releaseDate))if(w=moment(Q[E].releaseDate,"YYYYMMDDHHmm").valueOf(),_.isUndefined(Q[E].daysSupplyDispensed))l(A,w,w,c,D,1,y);else{var F=moment(w).add(Q[E].daysSupplyDispensed,"days").valueOf();r>=w&&(F>r&&(F=r),l(A,d(w,F,i),g(w,F,r),c,D,1,y,c))}}}}return t&&n.chart.height<100&&(n.chart.height=100),{chart:n.chart,yAxis:n.yAxis,series:n.series,name:n.name,instructions:n.instructions,xAxis:n.xAxis,uid:n.uid}}return e});
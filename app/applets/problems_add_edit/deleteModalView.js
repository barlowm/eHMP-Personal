define(["underscore","hbs!app/applets/problems_add_edit/delete","app/applets/problems/util"],function(e,t,n){function o(){l=new p({model:d});var e={title:"Remove Problem : "+d.get("summary"),size:"medium",footerView:m,callShow:!0},t=new ADK.UI.Modal({view:l,options:e});t.show()}function i(e,t){a=e,d=t,d.sync=c.sync,d.parse=c.parse,d.url=c.url;var n=ADK.PatientRecordService.getCurrentPatient();if(n.get("visit"))o();else{var i=ADK.Messaging.getChannel("visit");i.command("openVisitSelector","visit_select"),i.on("set-visit-success:visit_select",function(){$("#mainModal").one("hidden.bs.modal",o)})}}function r(){$("#nextBtn").attr("disabled",!1)}var a,l,d,s=ADK.Messaging.getChannel("problem-add-edit"),c={sync:function(t,n,o){var i={type:"POST",url:n.url(),contentType:"application/json",data:JSON.stringify({problemIEN:n.get("uid").split(":").pop(),providerID:n.get("providerUid")?n.get("providerUid").split(":").pop():-1,reason:reason,action:"delete"}),dataType:"json"};$.ajax(e.extend(i,o))},url:function(){var e=ADK.PatientRecordService.getCurrentPatient().get("pid");return ADK.ResourceService.buildUrl("problems-UpdateProblem",{pid:e})},parse:function(e){return e=n.getStandardizedDescription(e),e=n.getStatusName(e),e=n.getServiceConnected(e),e=n.getProblemText(e),e=n.getICDCode(e),e=n.getAcuityName(e),e=n.getFacilityColor(e),e=n.getOnsetFormatted(e),e=n.getEnteredFormatted(e),e=n.getUpdatedFormatted(e),e=n.getCommentBubble(e)}};s.comply("openProblemDelete",i);var m=Backbone.Marionette.ItemView.extend({template:e.template('<div class="pull-right"><button id="cancelBtn" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button><button id="deleteBtn" type="button" class="btn btn-danger">Remove</button></div>'),events:{"click #deleteBtn":function(e){this.deleteProblem(e)}},deleteProblem:function(e){$("#deleteProblemModal #error-container").text(""),reason=$("#reason").val(),l.model.destroy({success:function(){ADK.UI.Modal.hide()},error:function(e){$("#deleteProblemModal #error-container").text("Remove Failed"),$("#deleteProblemModal #error-container").focus()}})}}),p=(Backbone.Marionette.ItemView.extend({model:c,template:t,tagName:"div",attributes:{},initialize:function(){this.model=new c,this.model.set("id","xxx")}}),Backbone.Marionette.LayoutView.extend({template:t,regions:{problem:"#problem-body"},initialize:function(){this.model.set("id","xxx")},updateProblems:function(){r()}}));return p});
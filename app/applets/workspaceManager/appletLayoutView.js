define(["underscore","backbone","marionette","handlebars","hbs!app/applets/workspaceManager/list/screenEditor","app/applets/workspaceManager/list/WorkspaceCollectionView","gridster","app/applets/workspaceManager/list/PreviewWorkspaceView"],function(e,n,t,r,i,a,c,s){"use strict";var o=n.Marionette.ItemView.extend({template:r.compile(['<p>Are you sure you want to delete <b>{{screenTitle}}?</b></p><span class="sr-only">Note that you will be redirected to the beginning of this screen after deleting a workspace.</span>'].join("\n"))}),l=n.Marionette.ItemView.extend({template:r.compile(['{{ui-button "Cancel" classes="btn-default" title="Click to cancel and close this dialog"}}','{{ui-button "Delete" classes="btn-danger" title="Click to delete this workspace"}}'].join("\n")),events:{"click .btn-default":function(){ADK.UI.Alert.hide(),this.model.get("buttonEl").focus()},"click .btn-danger":function(){ADK.ADKApp.ScreenPassthrough.deleteUserScreen(this.model.get("screenId")),ADK.UI.Alert.hide(),ADK.UI.FullScreenOverlay.hide();var e=ADK.Messaging.getChannel("workspaceManagerChannel");e.trigger("workspaceManager",function(){var e=new ADK.UI.FullScreenOverlay({view:new d,options:{callShow:!0}});e.show()})}}}),d=n.Marionette.LayoutView.extend({template:i,className:"workspaceManager-applet",initialize:function(){this.model=new n.Model;ADK.ADKApp[n.history.fragment],ADK.Messaging.getChannel("managerAddScreen")},regions:{managerRegion:"#list-group",previewRegion:".previewRegion"},events:{"keyup #searchScreens":"filterScreens","keydown #searchScreens":function(e){13==e.which&&(e.preventDefault(),this.filterScreens())},"click #clearSearch":"clearSearch","click #doneEditing":"hideOverlay","click .addScreen":"triggerAddNew","click .delete-worksheet":"removeScreen","click .previewWorkspace":"showPreview","click .closePreview":"hidePreview","keydown [tabindex]:not(input)":"handleSpacebarOrEnter"},hideOverlay:function(){ADK.UI.FullScreenOverlay.hide(),ADK.Messaging.trigger("close:workspaceManager")},onBeforeAttach:function(){this.managerRegion.show(new a)},handleSpacebarOrEnter:function(e){return 13===e.which||32===e.which?(e.preventDefault(),e.stopPropagation(),$(e.target).click(),!1):void 0},filterScreens:function(){var e=this.$el.find("#searchScreens").val();this.managerRegion.currentView.filterScreens(e),e?this.$el.find("#clearSearch").show():this.$el.find("#clearSearch").hide()},clearSearch:function(){this.$el.find("#searchScreens").val(""),this.filterScreens(),this.$el.find("#searchScreens").focus()},editScreen:function(e){$(e.currentTarget).find("p").text()},removeScreen:function(e){var t=$(e.currentTarget),r=new n.Model({screenTitle:t.closest(".tableRow").find("input")[0].value}),i=new n.Model({screenId:t.closest(".tableRow").attr("id"),buttonEl:t}),a=new ADK.UI.Alert({title:"Delete Workspace",messageView:o.extend({model:r}),footerView:l.extend({model:i})});a.show()},triggerAddNew:function(){h.command("addNewScreen")},showPreview:function(n){var t=$(n.target).closest(".tableRow"),r=t.find(".editor-input-element").val();r=e.isUndefined(r)?t.find(".editor-title").text():r;var i=new s({screenId:t.attr("id"),screenTitle:r});this.previewRegion.show(i)},hidePreview:function(e){this.previewRegion.empty()},onBeforeDestroy:function(){var e=ADK.Messaging.getChannel("managerAddScreen");e.stopComplying("deleteScreen",this.removeScreenActive,self)}}),h=ADK.Messaging.getChannel("managerAddScreen");return d});
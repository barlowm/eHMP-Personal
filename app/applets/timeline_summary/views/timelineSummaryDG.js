define(["jquery","jquery.inputmask","moment","backbone","marionette","underscore","hbs!app/applets/timeline_summary/views/timelineSummaryDGTemplate","hbs!app/applets/newsfeed/summary/formatDateTemplate","app/applets/newsfeed/summary/activityCell","app/applets/newsfeed/newsfeedUtils"],function(e,t,i,a,n,r,o,s,l,m){"use strict";var c,d,p={};d=a.Collection.extend({}),c=[{name:"activityDateTime",label:"Date & Time",cell:"handlebars",template:s,groupable:!0,groupableOptions:{primary:!0,innerSort:"activityDateTime",groupByFunction:function(e){return e.model.get("activityDateTime").substr(0,6)},groupByRowFormatter:function(e){return i(e,"YYYYMM").format("MMMM YYYY")}}},{name:"activityDateTimeByIso",renderable:!1,sortable:!1},{name:"activityDateTimeByIsoWithSlashes",renderable:!1,sortable:!1},{name:"activity",label:"Activity",cell:l,sortable:!1},{name:"displayType",label:"Type",cell:"string",groupable:!0,groupableOptions:{innerSort:"activityDateTime"}}],p.columns=c,p.appletConfig={name:"timeline_summary",id:"timeline_summary"};var u=a.Marionette.LayoutView.extend({template:o,fetchOptions:{},initialize:function(e){this.fetchTimelineData(),this.listenTo(ADK.Messaging,"globalDate:customDateRangeSelected",this.fetchTimelineData())},regions:{dataZone:"#timeline-summary-results"},onRender:function(){},onShow:function(){},fetchTimelineData:function(){var e=this;this.fetchOptions.criteria={filter:'or(eq(kind, "Visit"),eq(kind, "Immunization"),eq(kind, "Admission"),eq(kind, "Surgery"),eq(kind, "Procedure"),eq(kind, "Consult")),or('+ADK.ResourceService.buildJdsDateFilter("dateTime")+","+ADK.ResourceService.buildJdsDateFilter("administeredDateTime")+")",order:"dateTime DESC"},this.fetchOptions.resourceTitle="patient-record-newsfeed",this.fetchOptions.viewModel={parse:function(e){return e.activityDateTime=m.getActivityDateTime(e),e.primaryProviderDisplay=m.getPrimaryProviderDisplay(e),e.displayType=m.getDisplayType(e),e.activityDateTimeByIso=i(e.activityDateTime,"YYYYMMDDHHmmss").format("YYYY-MM-DD HH:mm"),e.activityDateTimeByIsoWithSlashes=i(e.activityDateTime,"YYYYMMDDHHmmss").format("YYYY/MM/DD HH:mm"),e}},this.fetchOptions.onSuccess=function(t,i){p.collection=t,e.dataGrid=ADK.Views.DataGrid.create(p),void 0!==e.dataZone&&null!==e.dataZone&&(e.dataZone.reset(),e.dataZone.show(e.dataGrid)),p.collection=e.collection},ADK.PatientRecordService.fetchCollection(this.fetchOptions)}});return u});
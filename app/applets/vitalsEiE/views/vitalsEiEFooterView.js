define(["underscore","jquery","hbs!app/applets/vitalsEiE/templates/vitalsEiEFooterTemplate"],function(e,t,i){var a="#vitalsEiE-error-messages",r="You must give a reason in order to mark a vital in error.",s="The patient id could not be identified for deleting the specified vital.",n={},o=Backbone.Marionette.ItemView.extend({initialize:function(){n=this,this.model.set("isDisabled",!0);var e=ADK.Messaging.getChannel("vitalsEiE");e.comply("vitalsEiE:validated",function(e){n.setDisabled(e)})},onBeforeDestroy:function(){var e=ADK.Messaging.getChannel("vitalsEiE");e.stopComplying("vitalsEiE:validated")},template:i,events:{"click #vitals-EiE-submit":"save"},modelEvents:{"change:isDisabled":"disabledChanged"},disabledChanged:function(){this.render()},save:function(i){i.preventDefault(),n.showLoadingTextOnButton(i,!0);var o=[],l=t("input[name='reason']:checked").val(),d=this.model.get("models"),p=ADK.PatientRecordService.getCurrentPatient(),c=(ADK.UserService.getUserSession(),p.get("icn")||p.get("pid")||p.get("id")),v="resource/write-health-data/patient/"+c+"/vitals/",u=[];if(n.resetErrors(),e.isEmpty(l)===!1)if(e.isEmpty(c)===!1){var g=[],f=t.Deferred();if(d.forEach(function(e){var i=e.get("localId");e.get("uid");if(i){var a=t("#"+i);if(a.prop("checked")===!0){var r=g.indexOf(i);0>r&&g.push(i)}}}),!e.isEmpty(g)){u.push(f);var h=JSON.stringify({ien:g.join(","),reason:l}),m={type:"PUT",url:v+g[0],contentType:"application/json",data:h,dataType:"json"},E=t.ajax(m);E.done(function(e){f.resolve(e)}),E.fail(function(){f.resolve()})}}else error.push({el:a,message:s});else error.push({el:a,message:r});t.when.apply(t,u).then(function(e){n.showLoadingTextOnButton(i,!1),o.length<=0?(ADK.UI.Modal.hide(),setTimeout(function(){ADK.Messaging.getChannel("vitals").request("refreshGridView")},2e3)):(n.setDisabled("true"),n.displayErrors(o))})},setDisabled:function(e){n.model.set("isDisabled",e)},showLoadingTextOnButton:function(e,i){var a=t(e.currentTarget),r="button-text",s=!1;a.prop("aria-atomic",!1),i&&(r="loading-text",s=!0,a.prop("aria-atomic",!0)),a.prop("disabled",s);var n=a.data(r);a.html(n)},resetErrors:function(){var i=t(".vitals-error");e.each(i,function(e){var i=t(e);i.find(".error-message").remove(),i.removeClass("vitals-error applet-error")})},displayErrors:function(i){e.each(i,function(e){var i=t(e.el);i.addClass("vitals-error"),i.prop("aria-inavalid",!0),i.prepend("<p class='error-message applet-error' aria-atomic='true' tab-index='0'>"+e.message+"</p>")})}});return n=o,o});
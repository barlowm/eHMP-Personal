define(["app/applets/user_info/appletUtil"],function(e){var s={};return s.createUserList=function(){var r={resourceTitle:"user-service-userlist",cache:!1,pageable:e.isUserListPageable,onSuccess:function(r){e.isValidUsersList(r,e.isUserListPageable)?s.createRolesLabelsForAllUsers(r):e.showUsersAlert("Cannot get user list.")},onError:function(s,r){e.showUsersAlert(s)}};return ADK.ResourceService.fetchCollection(r)},s.createRolesLabelsForAllUsers=function(s){var r={resourceTitle:"roles-list",cache:!0,pageable:!1,onSuccess:function(r,o){if(e.isValidRolesMap(o)){var l=[];l=e.isUserListPageable===!0?s.fullCollection.models:s.models,_.each(l,function(s){var r=e.getCorrespondentLabels(s,o);s.set("rolesLabels",r)})}else e.showRolesAlert("Cannot create roles labels for users.","Retrieving roles error")},onError:function(s,r){var o=JSON.parse(r.responseText).message;e.showRolesAlert(o,"Retrieving roles error")}};ADK.ResourceService.fetchCollection(r)},s.editUserRoles=function(r,o){var l={resourceTitle:"roles-edit",fetchType:"PUT",cache:!0,pageable:!1,criteria:{user:JSON.stringify(r),roles:JSON.stringify(o.val)},onSuccess:function(o,l){e.isValidEditedRoles(l)?(r.set("roles",l.data),s.createRolesLabelsForOneUser(r)):e.showRolesAlert("Cannot edit user roles.","Editing roles error")},onError:function(s,r){var o=JSON.parse(r.responseText).message;e.showRolesAlert(o,"Editing roles error")}};ADK.ResourceService.fetchCollection(l)},s.createRolesLabelsForOneUser=function(s){var r={resourceTitle:"roles-list",cache:!0,pageable:!1,onSuccess:function(r,o){if(e.isValidRolesMap(o)){var l=e.getCorrespondentLabels(s,o);s.set("rolesLabels",l)}else e.showRolesAlert("Cannot create roles labels for this user.","Mapping roles error")},onError:function(s,r){var o=JSON.parse(r.responseText).message;e.showRolesAlert(o,"Mapping roles error")}};ADK.ResourceService.fetchCollection(r)},s.userInfoViewOnClickRow=function(s,r){var o=ADK.UserService.getUserSession().get("duz"),l=(o[r.get("site")],{resourceTitle:"roles-list",cache:!0,pageable:!1,onSuccess:function(o,l){if(e.isValidRolesMap(l)){var t=s.createModalView(r,l);t.show()}else e.showRolesAlert("Cannot create list of roles.")},onError:function(s,r){var o=JSON.parse(r.responseText).message;e.showRolesAlert(o)}});ADK.ResourceService.fetchCollection(l)},s});
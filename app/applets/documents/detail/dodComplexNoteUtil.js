define(["backbone","marionette","app/applets/documents/debugFlag"],function(t,e,n){"use strict";function o(t){var e=t.find("img");e.each(function(t,e){e=$(e);var n=""+(e.width()||e.attr("width"));e.removeAttr("height"),e.removeAttr("width"),"px"!==n.substring(n.length-2)&&(n+="px"),e.css("max-width",n),e.css("background-size","contain"),e.css("width","100%")})}function d(t){var e="";return t.forEach(function(t){e.length>0&&(e+=","),e+=t+":not([tabindex])"}),e}function i(t){var e=["td","p","div","span","h1","h2","h3","h4","h5","h6"],n=t.find(d(e));n.attr("tabindex","0"),n.attr("data-add-tabindex",!0),n.each(function(t,e){e=$(e);var n=e.find("[data-add-tabindex]");n.size()>0&&(e.removeAttr("tabindex"),e.removeAttr("data-add-tabindex"))})}var a=(n.flag,{parseModel:function(t){return t},massageContent:function(){var t=$(".dodContent");if(t.size()>0){var e=$(t[0].contentWindow.document);o(e),i(e),e.find("table[width],col[width],tr[width],th[width],td[width]").removeAttr("width"),e.find("table[height],col[height],tr[height],th[height],td[height]").removeAttr("height"),e.find("body").css("background-color","#f5f5f5")}},writeDodNoteContent:function(t,e){var n=t.get("dodComplexNoteContent"),o=e?e.$el.find(".dodContent"):$(".dodContent");if(o.size()>0){var d=o[0].contentWindow.document;d.open(),d.write(n),d.close()}},scaleDodIframeToContent:function(){var t=$(".dodContent");if(t.size()>0){var e=$(t[0].contentWindow.document).height();t.height(e)}},showContent:function(t){function e(){n.writeDodNoteContent(t),n.massageContent(),n.scaleDodIframeToContent(),ADK.Messaging.getChannel("search").trigger("documentsLoaded",$(".dodContent").contents().find("body"))}var n=this,o=$("iframe.dodContent");if(0===o.size()){var d=new MutationObserver(function(t){t.forEach(function(t){for(var n=0;n<t.addedNodes.length;n++)o=$(t.addedNodes[n]).find("iframe.dodContent"),o.size()>0&&(d.disconnect(),e())})});d.observe($("#modal-region")[0],{childList:!0,attributes:!1,characterData:!0,subtree:!0})}else e()}});return a});
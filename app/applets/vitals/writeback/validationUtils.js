define([],function(){var e={validateHistorical:function(e,t){var r=ADK.PatientRecordService.getCurrentPatient(),i=r.get("pid"),u=e.get("heightInputValue"),a=e.get("weightInputValue");if(!u&&!a)return void t();var n,s,l=ADK.UserService.getUserSession().get("site"),o=ADK.ResourceService.buildUrl("vitals-vitalsRule"),d={site:l,pid:i};if(u){var m=u.substring(u.length-2,u.length),p=Number(u.substring(0,u.length-2));n=p,"cm"===m&&(p=2.54*p),d.height={value:p,units:"in",enteredHeight:n,enteredUnits:m}}if(a){var g=a.substring(a.length-2,a.length),b=Number(a.substring(0,a.length-2));s=b,"kg"===g&&(b=2.20462*b),d.weight={value:b,units:"lb",enteredWeight:s,enteredUnits:g}}var v=e.get("temperatureInputValue");if(v){var h=v.substring(v.length-1,v.length),c=Number(v.substring(0,v.length-1));d.temperature={value:c,units:h}}var f=e.get("circumferencegirth");if(f){var V=f.substring(f.length-2,f.length),I=Number(f.substring(0,f.length-2));d.circumferencegirth={value:I,units:V}}e.get("bpInputValue")&&(d.bloodpressure={value:e.get("bpInputValue")}),e.get("respirationInputValue")&&(d.respiration={value:Number(e.get("respirationInputValue")),units:"/min"}),e.get("pulseInputValue")&&(d.pulse={value:Number(e.get("pulseInputValue")),units:"/min"}),e.get("pain-value-po")&&(d.pain={value:Number(e.get("pain-value-po"))}),e.get("O2InputValue")&&(d.pulseoximetry={value:Number(e.get("02InputValue")),units:"%"});var M={url:o,type:"POST",contentType:"application/json",dataType:"json",processData:!1,data:JSON.stringify(d)},y=$.ajax(M),w="8302-2",N="29463-7",D=this;y.done(function(e){if(e&&e.data){var r,i=e.data,u=_.filter(i.results,function(e){return e.body.reason?_.some(e.body.reason[0].coding,{code:w}):void 0});_.isEmpty(u)||(r=_.filter(i.results,function(e){return e.body.code?_.some(e.body.code.coding,{code:w}):void 0}));var a=_.filter(i.results,function(e){return e.body.reason?_.some(e.body.reason[0].coding,{code:N}):void 0}),n=_.filter(i.results,function(e){return e.body.code?_.some(e.body.code.coding,{code:N}):void 0}),s=!1;_.isEmpty(r)&&_.isEmpty(n)||(s=!0);var l=D.buildWarningMessage(d,u,r,a,n);t(s,l)}}),y.fail(function(e,r){var i="<p>Height (or Weight) difference from previous measurement could not be validated because the server is not available</p>";t(!0,i)})},areAllDataFieldsEmpty:function(e,t){return t||e.get("circumValue")||e.get("bpInputValue")||e.get("heightInputValue")||e.get("respirationInputValue")||e.get("pulseInputValue")||e.get("weightInputValue")||e.get("O2InputValue")||e.get("temperatureInputValue")||e.get("pain-value-po")||e.get("bp-radio-po")||e.get("pulse-radio-po")||e.get("respiration-radio-po")||e.get("temperature-radio-po")||e.get("height-radio-po")||e.get("weight-radio-po")||e.get("pain-radio-po")||e.get("cg-radio-po")||e.get("po-radio-po")||e.get("pain-checkbox-po")?!1:!0},buildWarningMessage:function(e,t,r,i,u){var a="Warnings Exist: <ul>";return _.isEmpty(t)||(a+="<li>"+_.first(_.first(t).body.payload).contentString+" </br>Just Entered: "+e.height.enteredHeight+e.height.enteredUnits+" in "+moment().format("MM/DD/YYYY h:mm a"),_.isEmpty(r)||(a+="</br>Previous Value: "+_.first(r).body.valueQuantity.value+_.first(r).body.valueQuantity.units+" in "+moment(_.first(r).body.issued).format("MM/DD/YYYY h:mm a")),a+="</li>"),_.isEmpty(u)||(a+="<li>The new weight value differs by 20% or more from previous values.</br>Just Entered: "+e.weight.enteredWeight+e.weight.enteredUnits+" in "+moment().format("MM/DD/YYYY h:mm a")+"</br>Previous Value: "+_.first(u).body.valueQuantity.value+_.first(u).body.valueQuantity.units+" in "+moment(_.first(u).body.issued).format("MM/DD/YYYY h:mm a")+"</li>"),a+="</ul> Check to ensure you have entered data for the correct patient's chart and in the correct units of measure. Do you want to save the new value?"},validateModel:function(e){if(e.errorModel.clear(),this.validateCircumferenceFields(e,e.get("circumValue")),this.validateBPFields(e,e.get("bpInputValue")),this.validateHeightFields(e,e.get("heightInputValue")),this.validateRespirationFields(e,e.get("respirationInputValue")),this.validatePulseFields(e,e.get("pulseInputValue")),this.validateWeightFields(e,e.get("weightInputValue")),this.validateSuppO2Fields(e,e.get("suppO2InputValue")),this.validateO2Fields(e,e.get("O2InputValue")),this.validateTemperatureFields(e,e.get("temperatureInputValue")),this.validateMeasuredDateAndTime(e,e.get("dateTakenInput"),e.get("time-taken")),this.validatePainFields(e,e.get("pain-value-po")),!_.isEmpty(e.errorModel.toJSON())){var t="Validation errors. Please fix.";return t}},validatePainFields:function(e,t){t&&(!this.validWholeNumber(t)||Number(t)<0||Number(t)>10)&&e.errorModel.set({"pain-value-po":"Pain value must be a whole number between 0 and 10"})},validateCircumferenceFields:function(e,t){if(t){var r=t.substring(t.length-2,t.length),i=Number(t.substring(0,t.length-2));if(!this.validDecimal(i))return void e.errorModel.set({circumValue:"Circumference must be a numeric value"});"in"===r?(1>i||i>200)&&e.errorModel.set({circumValue:"Circumference must be between 1 and 200 inches"}):(2.54>i||i>508)&&e.errorModel.set({circumValue:"Circumference must be between 2.54 and 508 centimeters"})}},validateBPFields:function(e,t){if(t){bpRegExCommon=/^(\d{1,3})\/(\d{1,3})$/,bpRegEx=/^(\d{1,3})\/(\d{1,3})\/(\d{1,3})$/;var r=bpRegExCommon.test(t),i=bpRegEx.test(t);i||r||e.errorModel.set({bpInputValue:"Blood Pressure value must be a valid format: nnn/nnn or nnn/nnn/nnn"});var u=t.split("/"),a=u[0],n=u[1],s=u[1];3==u.length&&(n=u[2],(Number(s)<0||Number(s)>300)&&e.errorModel.set({bpInputValue:"Blood Pressure Intermediate value must be a number between 0 and 300"})),(Number(a)<0||Number(a)>300)&&e.errorModel.set({bpInputValue:"Blood Pressure Systolic value must be a number between 0 and 300"}),(Number(n)<0||Number(n)>300)&&e.errorModel.set({bpInputValue:"Blood Pressure Diastolic value must be a number between 0 and 300"})}},validateHeightFields:function(e,t){if(t){var r=t.substring(t.length-2,t.length),i=Number(t.substring(0,t.length-2));if(!this.validDecimal(i))return void e.errorModel.set({heightInputValue:"Height must be a numeric value"});"in"===r?(10>i||i>100)&&e.errorModel.set({heightInputValue:"Height must be between 10 and 100 inches"}):(25.4>i||i>254)&&e.errorModel.set({heightInputValue:"Height must be between 25.4 and 254 centimeters"})}},validateRespirationFields:function(e,t){if(t){if(!this.validWholeNumber(t))return void e.errorModel.set({respirationInputValue:"Respiration must be a whole numeric value"});var r=Number(t);(0>r||r>100)&&e.errorModel.set({respirationInputValue:"Respiration must be between 0 and 100 /min"})}},validatePulseFields:function(e,t){if(t){if(!this.validDecimal(t))return void e.errorModel.set({pulseInputValue:"Beats must be a numeric value"});var r=Number(t);(0>r||r>300)&&e.errorModel.set({pulseInputValue:"Beats must be between 0 and 300 /min"})}},validateWeightFields:function(e,t){if(t){var r=t.substring(t.length-2,t.length),i=Number(t.substring(0,t.length-2));if(!this.validDecimal(i))return void e.errorModel.set({weightInputValue:"Weight must be a numeric value"});"lb"===r?(0>i||i>1500)&&e.errorModel.set({weightInputValue:"Weight must be between 0 and 1500 pounds"}):(0>i||i>680.39)&&e.errorModel.set({weightInputValue:"Weight must be between 0 and 680.39 kilograms"})}},validateSuppO2Fields:function(e,t){if(t){if(!this.validDecimal(t))return void e.errorModel.set({suppO2InputValue:"Flow Rate must be a numeric value"});var r=Number(t);(.5>r||r>20)&&e.errorModel.set({suppO2InputValue:"Flow Rate must be between 0.5 and 20 (liters/minute)"})}},validateO2Fields:function(e,t){if(t){if(!this.validWholeNumber(t))return void e.errorModel.set({O2InputValue:"O2 Concentration must be a whole numeric value"});var r=Number(t);(21>r||r>100)&&e.errorModel.set({O2InputValue:"O2 Concentration must be between 21 and 100"})}},validateTemperatureFields:function(e,t){if(t){var r=t.substring(t.length-1,t.length),i=Number(t.substring(0,t.length-1));if(!this.validDecimal(i))return void e.errorModel.set({temperatureInputValue:"Temperature must be a numeric value"});"F"===r?(45>i||i>120)&&e.errorModel.set({temperatureInputValue:"Temperature must be between 45 and 120 degrees F"}):(7.2>i||i>48.9)&&e.errorModel.set({temperatureInputValue:"Temperature must be between 7.2 and 48.9 degrees C"})}},validateMeasuredDateAndTime:function(e,t,r){if(t){var i=moment();if(r){var u=moment(t+" "+r,"MM/DD/YYYY hh:mm a");u.isAfter(i)&&(u.isSame(i,"day")?e.errorModel.set({"time-taken":"Measured Date/Time must be in the past."}):e.errorModel.set({dateTakenInput:"Measured Date/Time must be in the past."}))}else{var a=moment(t,"MM/DD/YYYY");a.isAfter(i)&&e.errorModel.set({dateTakenInput:"Measured Date/Time must be in the past."})}}},validDecimal:function(e){var t=/^[+-]?\.?[0-9]{1,9}(?:\.[0-9]{1,10})?$/;return t.test(e)},validWholeNumber:function(e){if(/^-?\d+$/.test(e)){var t=Number(e);return!isNaN(t)&&t%1===0}return!1}};return e});
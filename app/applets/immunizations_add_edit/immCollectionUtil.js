define(["underscore"],function(e){var t=Backbone.Model.extend({sync:function(t,r,o){var i={type:"POST",url:r.url(),contentType:"application/json",data:JSON.stringify(r.toJSON()),dataType:"json"};$.ajax(e.extend(i,o))},url:function(){var e=ADK.PatientRecordService.getCurrentPatient().get("pid");return ADK.ResourceService.buildUrl("immunization-crud-AddImmunization",{pid:e})}}),r={modifyInfoSourceCollection:function(t){var r=new Backbone.Collection;return e.each(t,function(e){if(0===e.source.toLowerCase().indexOf("historical")){var t=e.source.split("-");e.source=t[1].charAt(0).toUpperCase()+t[1].slice(1),r.add(e)}}),r},changeLotNumber:function(e){var t=e.get("expirationDate"),o=ADK.utils.formatDate(t,"MM/DD/YYYY","MMM DD, YYYY");$("#expiration-date").val(o).attr("disabled",!0),$("#manufacturer").val(e.get("manufacturer")).attr("disabled",!0),r.checkFormReadyForSubmit()},checkFormReadyForSubmit:function(){$("#route-admin option:selected").text()&&$("#anatomic-location option:selected").text()&&$("#lot-num-obs option:selected").text()?$("#imm-submit").attr("disabled",!1):$("#imm-submit").attr("disabled",!0)},validateFormInputAndShowErrors:function(e){r.removePreviousErrors();var t=0;if("true"===$("#immunization-btn-historical").attr("data-is-active"))"default"===$("#info-source").find(":selected").val()&&($("#info-source-error").attr("aria-hidden",!1).text("Required.").focus(),t++);else{var o=!1;e.adminProviderView.model||($("#admin-provider-error").attr("aria-hidden",!1).text("Must be selected from the list of providers."),o||($("#admin-provider-error").focus(),o=!0),t++),!e.orderingProviderView.model&&$("#ordering-provider").val()&&($("#ordering-provider-error").attr("aria-hidden",!1).text("Must be selected from the list of providers."),o||($("#ordering-provider-error").focus(),o=!0),t++),!e.locationView.model&&$("#location").val()&&($("#location-error").attr("aria-hidden",!1).text("Must be selected from the list of locations."),o||($("#location-error").focus(),o=!0),t++),$("#lot-num-obs option:selected").text()||($("#lot-num-obs-error").attr("aria-hidden",!1).text("Required."),o||($("#lot-num-obs-error").focus(),o=!0),t++),$("#route-admin option:selected").text()||($("#route-admin-error").attr("aria-hidden",!1).text("Required."),o||($("#route-admin-error").focus(),o=!0),t++),$("#anatomic-location option:selected").text()||($("#anatomic-location-error").attr("aria-hidden",!1).text("Required."),o||($("#anatomic-location-error").focus(),o=!0),t++)}return 0===t},removePreviousErrors:function(){$("#add-edit-imm-error").attr("aria-hidden",!0).addClass("hidden"),$("#info-source-error").attr("aria-hidden",!0).text(""),$("#admin-provider-error").attr("aria-hidden",!0).text(""),$("#ordering-provider-error").attr("aria-hidden",!0).text(""),$("#location-error").attr("aria-hidden",!0).text(""),$("#anatomic-location-error").attr("aria-hidden",!0).text(""),$("#route-admin-error").attr("aria-hidden",!0).text(""),$("#lot-num-obs-error").attr("aria-hidden",!0).text("")},filterOutInactiveLotNumbers:function(t){var r=new Backbone.Collection;return e.each(t,function(e){"active"===e.status.toLowerCase()&&r.add(e)}),r},filterOutHistoricalInfoStatements:function(t){var r=new Backbone.Collection,o=[];return e.each(t,function(t){t.status&&"historic"!==t.status.toLowerCase()&&!e.contains(o,t.name)&&(o.push(t.name),r.add(t))}),r},buildSubmitModel:function(e){var r=new t,o=moment($("#admin-date-time").val(),"MM/DD/YYYY").format("YYYYMMDD");r.set("encounterServiceCategory","E"),r.set("visitDate",o),r.set("immunizationIEN",e.get("localId"));var i=$("#reaction").val();return i&&r.set("reaction",Number(i)),r}};return r});
define(["backbone","marionette","underscore","hbs!app/applets/addLabOrders/templates/addLabOrderTemplate","hbs!app/applets/addLabOrders/templates/footerTemplate","hbs!app/applets/addLabOrders/templates/visitRegionTemplate","app/applets/visit/typeaheadView","app/applets/addLabOrders/utils/labOrdersUtil","app/applets/addLabOrders/utils/labSearchBloodhound"],function(i,l,c,t,a,o,n,d,p){"use strict";function m(e,i){ADK.PatientRecordService.getCurrentPatient();C=e,v=i,P.command("openVisitSelector","addLabOrders")}function s(i){var l={title:"Add a Lab Order",footerView:M,headerView:q};B=new w({model:v});var c=new ADK.UI.Modal({view:B,options:l});c.show(),console.log("we got here!"),e.preventDefault()}function r(e){$("#collection-sample-select").empty();var i;i=e.collSamps?e.collSamps:N(),$.each(i,function(e,i){$("#collection-sample-select").append($("<option>").text(i.collSamp).attr("value",i.id))})}function S(e){$("#specimen-select").empty();var i;i=e.specimens?e.specimens:U(),$.each(i,function(e,i){$("#specimen-select").append($("<option>").text(i.specimen).attr("value",i.id))})}function u(e){$("#urgency-select").empty(),e.urgencies?$.each(e.urgencies,function(e,i){$("#urgency-select").append($("<option>").text(i.urgency).attr("value",i.id))}):console.log("Need to show entire list"),e.defaultUrgency?($("#urgency-select").prop("disabled",!0),$("#urgency-select").append($("<option>").text(e.defaultUrgency.urgency).attr("value",e.defaultUrgency.id))):$("#urgency-select").prop("disabled",!1),$('#urgency-select[name*="ROUTINE"]')&&$("#urgency-select").val(9)}function E(e){e.reqCom&&"TDM (PEAK-TROUGH)"===e.reqCom?$(".show-draw-time-options").show():$(".show-draw-time-options").hide(),e.reqCom&&"ANTICOAGULATION"===e.reqCom?$(".show-anticoagulant").show():$(".show-anticoagulant").hide()}function O(e){$("#frequency-select").empty();var i=h();$.each(i,function(e,i){$("#frequency-select").append($("<option>").text(i.frequency).attr("value",i.id))}),$("#frequency-select").val(28),$("#frequency-length").prop("disabled",!0)}function L(e){$("#collection-type-select").empty(),$("#collection-type-select").append($("<option>").text("Lab Collect").attr("value","LC")),$("#collection-type-select").append($("<option>").text("Ward Collect").attr("value","WC")),$("#collection-type-select").append($("<option>").text("Send Patient to Lab").attr("value","SP")),$("#collection-type-select").append($("<option>").text("Immediate Collect").attr("value","I"))}function A(e){e.drawDoseTimes?$(".show-last-draw-time").show():$(".show-last-draw-time").hide()}function I(e){e.genWardInstructions?($("#notification-box-message").html(e.genWardInstructions),$(".notification-box").show()):T()}function R(e){$("#collection-datetime-select").empty(),$("#collection-datetime-select").append($("<option>").text("Today").attr("value",1))}function f(e){$("#lab-test-form-itemid").val(e.itemId),r(e),u(e),E(e),O(e),L(e),S(e),A(e),I(e),R(e),D()}function T(){$("#notification-box-message").empty(),$(".notification-box").hide()}function y(e){var i=$(e.target).val();"26"===i||"27"===i||"28"===i?$("#frequency-length").prop("disabled",!0).val(""):$("#frequency-length").prop("disabled",!1).focus()}function D(){var e=$("#lab-tests-form").val(),i=$("#collection-sample-select :selected").text();i=""===i?"":" "+i;var l=$("#collection-type-select").val(),c=$("#specimen-select :selected").text();c=""===c?"":" "+c,l=""===l?"":" "+l;var t=e+i+c+l;$("#previewOrder").html(t)}function N(){var e=[{id:68,collSamp:"24 HR URINE",specimenId:8755,specimen:"24 HR URINE"},{id:24,collSamp:"ABSCESS"},{id:75,collSamp:"AP SPECIMEN"},{id:49,collSamp:"ARTERIAL BLOOD",specimenId:8728,specimen:"ARTERIAL BLOOD"},{id:25,collSamp:"ASPIRATE"},{id:47,collSamp:"BACTEC 1ST SET 70",specimenId:1,specimen:"BLOOD"},{id:72,collSamp:"BACTEC 2ND SET 70 2ND SET",specimenId:1,specimen:"BLOOD"},{id:58,collSamp:"BATH TEST RED & BLUE",specimenId:1},{id:26,collSamp:"BIOPSY"},{id:20,collSamp:"BLOOD (BACTEC BTL.)"},{id:51,collSamp:"BLOOD (GREEN TOP)"},{id:56,collSamp:"BLOOD (NORMAL COAG)"},{id:57,collSamp:"BLOOD (ABNORM COAG)"},{id:60,collSamp:"BLOOD (RED TOP)"},{id:61,collSamp:"BLOOD"},{id:1,collSamp:"BLOOD (GOLD TOP)"},{id:2,collSamp:"BLOOD  (GRAY)"},{id:3,collSamp:"BLOOD  (LAVENDER)"},{id:5,collSamp:"BLOOD  (BLACK TOP)"},{id:7,collSamp:"BLOOD  (BLUE)"},{id:8,collSamp:"BLOOD  (RED)"},{id:67,collSamp:"BLOOD BANK (RED & LAV)"},{id:27,collSamp:"BONE"},{id:28,collSamp:"BONE MARROW"},{id:19,collSamp:"BOTH URINE & BLOOD"},{id:66,collSamp:"BRONX TUBE^"},{id:29,collSamp:"BRUSH"},{id:63,collSamp:"CAP SURVEY"},{id:65,collSamp:"CAPILLARY TUBE (BLUE STRIPE)"},{id:55,collSamp:"CATHETER TIP"},{id:30,collSamp:"CELLOPHANE TAPE"},{id:45,collSamp:"CHANCRE"},{id:9,collSamp:"CSF"},{id:69,collSamp:"Container C"},{id:31,collSamp:"DECUBITUS"},{id:32,collSamp:"DIALYSATE"},{id:52,collSamp:"DIGOXIN"},{id:76,collSamp:"DISCHARGE"},{id:59,collSamp:"DRAINAGE"},{id:33,collSamp:"EXUDATE"},{id:71,collSamp:"FINGERSTICK"},{id:34,collSamp:"FLUID JUICE"},{id:35,collSamp:"HAIR"},{id:23,collSamp:"KILLIT AMPULE"},{id:64,collSamp:"LAVENDER PLASMA"},{id:36,collSamp:"NAIL"},{id:10,collSamp:"PERICARDIAL/THORACIC FLUID"},{id:11,collSamp:"PERITONEAL/ASCITIC FLUID"},{id:12,collSamp:"PLEURAL"},{id:77,collSamp:"RLE"},{id:38,collSamp:"SECRETIONS"},{id:16,collSamp:"SEMINAL FLUID"},{id:54,collSamp:"SERUM"},{id:37,collSamp:"SKIN"},{id:22,collSamp:"SPORE STRIP"},{id:18,collSamp:"SPUTUM"},{id:53,collSamp:"STERILITY STRIP"},{id:39,collSamp:"STONE(CALCULUS)"},{id:17,collSamp:"STOOL"},{id:41,collSamp:"SUTURE"},{id:50,collSamp:"SWAB"},{id:13,collSamp:"SYNOVIAL"},{id:40,collSamp:"TISSUE"},{id:14,collSamp:"UNKNOWN"},{id:15,collSamp:"URINE"},{id:62,collSamp:"URINE, DRUG SCREEN"},{id:43,collSamp:"VALVE"},{id:74,collSamp:"VBECS - NO SPECIMEN REQUIRED"},{id:42,collSamp:"WATER"},{id:73,collSamp:"WHATEVER"},{id:21,collSamp:"WOUND"},{id:48,collSamp:"ZZ ARTERIAL"},{id:70,collSamp:"ZZBLOOD"}];return e}function U(){var e=[{id:70,specimen:"BLOOD"},{id:71,specimen:"URINE"},{id:72,specimen:"SERUM"},{id:73,specimen:"PLASMA"},{id:74,specimen:"CEREBROSPINAL FLUID"},{id:76,specimen:"PERITONEAL FLUID"},{id:77,specimen:"PLEURAL FLUID"},{id:78,specimen:"SYNOVIAL FLUID"},{id:91,specimen:"PERICARDIAL FLUID"},{id:139,specimen:"FECES"},{id:360,specimen:"SPUTUM"},{id:999,specimen:"UNKNOWN"},{id:5864,specimen:"SEMINAL FLUID"},{id:8728,specimen:"ARTERIAL BLOOD"},{id:8752,specimen:"TEST SERUM"},{id:8753,specimen:"TEST-PLASMA NORM"},{id:8754,specimen:"TEST-PLASMA ABNORM"},{id:8755,specimen:"24 HR URINE"},{id:8756,specimen:"OTHER"}];return e}function h(){var e=[{id:90,frequency:"HOURLY",comp:60},{id:26,frequency:"NOW",comp:0},{id:27,frequency:"ONCE",comp:0},{id:28,frequency:"ONE TIME",comp:0},{id:70,frequency:"Q15MIN",comp:15},{id:48,frequency:"Q2H",comp:120},{id:88,frequency:"Q4HLR",comp:240},{id:75,frequency:"Q6-8H",comp:120},{id:51,frequency:"Q6H",comp:360},{id:85,frequency:"Q6H-TEST",comp:360},{id:58,frequency:"Q8H",comp:480},{id:59,frequency:"Q8HR",comp:480},{id:29,frequency:"QAM",comp:1440},{id:30,frequency:"QD",comp:1440},{id:31,frequency:"QH",comp:60},{id:44,frequency:"QMON",comp:43200},{id:64,frequency:"QMONTH",comp:43200},{id:32,frequency:"QOD",comp:2800},{id:33,frequency:"QW",comp:10080},{id:84,frequency:"WEEKLY",comp:10080}];return e}var C,B,v,g,b=ADK.Messaging.getChannel("addALabOrdersRequestChannel"),P=ADK.Messaging.getChannel("visit");P.on("set-visit-success:addLabOrders",s),b.comply("openOrdersSearch",m);var M=i.Marionette.ItemView.extend({template:a,events:{"click #btn-add-orders-accept":"addAcceptOrder"},addAcceptOrder:function(){var e={};d.save(e),console.log("order accept completed")}}),q=i.Marionette.ItemView.extend({template:c.template('<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" aria-label="Close">Ã—</span></button><h4 class="modal-title" id="mainModalLabel">Order a Lab Test</h4>')}),w=i.Marionette.LayoutView.extend({className:"add-lab-orders-styles",template:t,events:{"click #notification-close-button":function(e){T()},"change #frequency-select":function(e){y(e)},"change #collection-sample-select":function(e){D()},"change #specimen-select":function(e){D()},"change #collection-type-select":function(e){D()}},initialize:function(){},onRender:function(){var e=p;e.initialize(),$(this.el).find("#lab-tests-form").typeahead({minLength:1,highlight:!0,hint:!0},{name:"labTest-search-item",displayKey:"testName",source:e.ttAdapter()}).on("typeahead:selected",function(e,i){f(i)})},showModal:function(e,i){g=i;var l={title:"Lab",size:"medium",footerView:M},c=new ADK.UI.Modal({view:this,options:l});c.show()}});return w});
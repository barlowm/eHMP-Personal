define(["backbone","marionette","app/applets/medication_review/list/medicationView","app/applets/medication_review/medicationCollectionHandler","hbs!app/applets/medication_review/list/detailTemplate","app/applets/medication_review/appletHelper"],function(e,i,t,r,n,o){function a(e,i){var t=o.getMedicationGroupbyData(i),r="eq("+t.groupbyField+',"'+t.groupbyValue+'")',n=$.Deferred();"name"===t.groupbyField&&(r='ilike(name,"'+t.groupbyValue+'%")'),console.log("groupby filter = "+r);var a={cache:!0,criteria:{filter:r},resourceTitle:"patient-record-med",viewModel:c};return a.onSuccess=function(e,i){n.resolve(e)},ADK.PatientRecordService.fetchCollection(a),n.promise()}var l=t.extend({template:n}),c={defaults:{fillsAllowed:"Unk"},parse:function(e){return o.parseMedResponse(e)}},d={initialize:function(i){var t=ADK.Messaging.getChannel(i);t.reply("detailView",function(i){var t=$.Deferred(),r={cache:!0,criteria:{uid:i.uid},resourceTitle:"patient-record-med",viewModel:c};return r.onSuccess=function(r,n){var o=a(i,r.models[0]);o.done(function(i){var n=new l({model:new e.Model({meds:i})});t.resolve({view:n,title:"Medication - "+r.first().get("name")})})},ADK.PatientRecordService.fetchCollection(r),t.promise()})}};return d});
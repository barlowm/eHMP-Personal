define(["backbone","marionette","hbs!app/applets/medication_review/list/medicationTemplate","app/applets/medication_review/list/orderDetailView","hbs!app/applets/medication_review/list/orderHistoryTemplate","hbs!app/applets/medication_review/list/infoButtonTemplate","hbs!app/applets/medication_review/list/infoButtonTemplate2","hbs!app/applets/medication_review/list/infoButtonPatientTemplate","app/applets/medication_review/appletHelper"],function(e,t,i,n,o,a,s,r,l){var d,u=e.Marionette.ItemView.extend({template:o,tagName:"li",className:"order-dates-range",attributes:{role:"listitem"},initialize:function(){this.parentView=d},events:{click:"updateDetailView","click .order-dates":"selectOrder","keydown .order-dates":"onEnter"},updateDetailView:function(e){e.preventDefault(),this.parentView.updateDetailView(this.model),this.selectOrder()},selectOrder:function(){$(this.parentView.$el).find(".selectedOrder").removeClass("selectedOrder"),$(this.$el).addClass("selectedOrder")},onEnter:function(e){(13==e.which||32==e.which)&&$(e.target).click()}}),c=e.Marionette.CollectionView.extend({tagName:"ul",attributes:{role:"list"},className:"orders-links-list",childView:u,onRender:function(){$(this.$el).find("li").first().addClass("selectedOrder")}}),h=e.Model.extend({defaults:{url:""},parse:function(e){return e}}),m=new h({}),p=e.Marionette.ItemView.extend({onRender:function(){}}),f=e.Model.extend({defaults:{url:""},parse:function(e){return e}}),w=e.Marionette.ItemView.extend({onRender:function(){}}),V=new f({}),B=e.Marionette.LayoutView.extend({initialize:function(){d=this,this.orderHistoryListView=new c({collection:this.model.get("meds"),parentLayoutView:d}),this.orderDetailView=new n({model:this.model.get("meds").models[0]});var e=ADK.UserService.getUserSession(),t=e.get("infoButtonOid");"1.3.6.1.4.1.3768"==t?(this.infoButtonView=new p({model:m,template:a}),this.infoButtonPatientView=new w({model:V,template:r})):void 0===t?(t="1.3.6.1.4.1.3768",this.infoButtonView=new p({model:m,template:a}),this.infoButtonPatientView=new w({model:V,template:r})):(this.infoButtonView=new p({model:m,template:s}),this.infoButtonPatientView=new w({model:V,template:s}));var i=this.orderDetailView.model.get("name"),o=i.search(/,|[0-9]/);for(o>0&&(i=i.substr(0,o)),o=i.search(" tab"),-1!=o&&(i=i.substr(0,o)),o=i.search(" cap"),-1!=o&&(i=i.substr(0,o)),o=i.search(" inj"),-1!=o&&(i=i.substr(0,o)),o=i.search(" soln"),-1!=o&&(i=i.substr(0,o)),o=i.search(" aerosol"),-1!=o&&(i=i.substr(0,o)),o=i.search(" drip"),-1!=o&&(i=i.substr(0,o)),o=i.search(" oral"),-1!=o&&(i=i.substr(0,o));-1!=i.search(" ");)i=i.replace(" ","%20");var l="/infobutton-service/infoRequest?representedOrganization.id.root="+t;l+="&taskContext.c.c=MLREV",l+="&mainSearchCriteria.v.dn=",l+=i,l+="&informationRecipient=PROV",l+="&informationRecipient.languageCode.c=en",l+="&performer=healthcareProvider",l+="&xsltTransform=Infobutton_UI_VA";var u="/infobutton-service/infoRequest?representedOrganization.id.root="+t;u+="&taskContext.c.c=MLREV",u+="&mainSearchCriteria.v.dn=",u+=i,u+="&informationRecipient=PAT",u+="&informationRecipient.languageCode.c=en",u+="&performer=healthcareProvider",u+="&xsltTransform=Infobutton_UI_VA";var h=[],f=[];h[0]="http://clinicalpharmacology-ip.com/Forms/search.aspx?s="+i,f[0]="Clinical Pharmacology",h[1]="http://home.mdconsult.com/public/search?mdcquery="+i,f[1]="MDConsult",h[2]="http://www.uptodate.com/online/content/search.do?",h[2]+="searchType=HL7&amp;taskContext.c.c=MLREV&amp;taskContext.c.cs=2.16.840.1.113883.5.4",h[2]+="&amp;mainSearchCriteria.v.dn="+i,f[2]="UpToDate",h[3]="http://www.visualdx.com/visualdx/visualdx6/infobutton.do?",h[3]+="taskContext.c.c=MLREV&taskContext.c.cs=2.16.840.1.113883.5.4",h[3]+="&mainSearchCriteria.v.dn="+i,f[3]="VisualDx",this.infoButtonView.model.set("openInfoButtonUrl1",h[0]),this.infoButtonView.model.set("openInfoButtonSiteName1",f[0]),this.infoButtonView.model.set("openInfoButtonUrl2",h[1]),this.infoButtonView.model.set("openInfoButtonSiteName2",f[1]),this.infoButtonView.model.set("openInfoButtonUrl3",h[2]),this.infoButtonView.model.set("openInfoButtonSiteName3",f[2]),this.infoButtonView.model.set("openInfoButtonUrl4",h[3]),this.infoButtonView.model.set("openInfoButtonSiteName4",f[3]);var B="http://infobutton.staywellsolutionsonline.com/infobuttonsearch.pg?";B+="mainSearchCriteria.v.dn="+i;var g="Krames StayWell";this.infoButtonPatientView.model.set("infoButtonPatientUrl1",B),this.infoButtonPatientView.model.set("infoButtonPatientSiteName1",g),this.infoButtonPatientView.model.set("infoButtonPatientUrl2",h[2]),this.infoButtonPatientView.model.set("infoButtonPatientSiteName2",f[2]),this.infoButtonPatientView.model.set("infoButtonPatientUrl3",h[3]),this.infoButtonPatientView.model.set("infoButtonPatientSiteName3",f[3]),this.model.set("activeCount",this.countMedStatus(this.model.get("meds"),"ACTIVE")),this.model.set("pendingCount",this.countMedStatus(this.model.get("meds"),"PENDING"))},templateHelpers:{isNonVa:function(){return"N"===d.model.get("meds").models[0].get("vaType")?!0:!1},isNotDiscontinued:function(){return"DISCONTINUED"!==this.vaStatus?!0:!1}},countMedStatus:function(e,t){var i=0;return e.forEach(function(e){e.get("standardizedVaStatus").toUpperCase()===t&&i++}),i>1?i:null},onRender:function(){this.orderHistoryRegion.show(this.orderHistoryListView),this.orderDetailRegion.show(this.orderDetailView),this.infoButtonRegion.show(this.infoButtonView),this.infoButtonPatientRegion.show(this.infoButtonPatientView)},updateDetailView:function(e){this.orderDetailView.model=e,this.orderDetailView.render(),this.showHideDiscontiueBtn(e)},launchDiscontinueNonVaMedModal:function(e){e.preventDefault();var t=ADK.Messaging.getChannel("medicationChannel");t.trigger("discontinueNonVaMed:clicked",e,this.orderDetailView.model)},launchEditNonVaMedModal:function(e){e.preventDefault();var t=ADK.Messaging.getChannel("medicationChannel");t.trigger("editNonVaMed:clicked",e,this.orderDetailView.model)},onOrderNavKeyDown:function(e){(13===e.which||32===e.which)&&$(e.target).click()},showHideDiscontiueBtn:function(e){"DISCONTINUED"===e.get("vaStatus")?$("#discontinue").hide():$("#discontinue").show()},template:i,regions:{orderHistoryRegion:"#order-history-panel",orderDetailRegion:"#order-detail-panel",infoButtonRegion:"#info-button-panel",infoButtonPatientRegion:"#info-button-patient-panel"},events:{"click #discontinue":"launchDiscontinueNonVaMedModal","click #edit":"launchEditNonVaMedModal","keydown .orderNav":"onOrderNavKeyDown"}});return B});
define(["underscore","backbone","marionette","hbs!app/applets/addApplets/list/appletSlider","app/applets/appletsManifest"],function(e,t,i,n,o){"use strict";var s=t.Marionette.LayoutView.extend({template:n,initialize:function(i){this.collection=new t.Collection(e.filter(o.applets,function(t){var i=t.permissions||[],n=!0;return e.each(i,function(e){return ADK.UserService.hasPermission(e)?void 0:(n=!1,!1)}),t.showInUDWSelection&&n})),this.collection.comparator="title",this.collection.sort(),this.collectionOrig=this.collection.clone(),this.model=new t.Model({}),this.setModel();var n=this;$(window).on("resize.appletSelectionSlider",function(){n.isDestroyed||(n.setModel(),n.render())})},onBeforeDestroy:function(){$(window).off("resize.appletSelectionSlider")},getNumberPerSlides:function(){var e=$(window).width();return Math.ceil((e-300)/90)},setModel:function(){var e=this.getNumberPerSlides(),t=Math.ceil(this.collection.length/e);this.model.set({paginationHtml:this.getPaginationHtml(t),appletItemsHtml:this.getAppletItemsHtml(this.collection,e)})},onRender:function(){var e=ADK.Messaging.getChannel("addApplets"),t=this.$el.find(".carousel").carousel({interval:!1,wrap:!0}),i=this.$el;i.find(".glyphicon-chevron-right").on("keydown",function(e){13===e.which&&t.on("slid.bs.carousel",function(){i.find(".active").find(".applet-thumbnail").first().focus(),t.off("slid.bs.carousel")})}),i.find(".glyphicon-chevron-left").on("keydown",function(e){13===e.which&&t.on("slid.bs.carousel",function(){i.find(".active").find(".applet-thumbnail").first().focus(),t.off("slid.bs.carousel")})}),this.$el.find(".carousel-inner").width($(window).width()-200),this.$el.find(".pagination").css("top","60px"),this.$el.find(".item").drag({items:".applet-thumbnail",helper:"clone",start:function(e){var t=i.find(".helper");t.css("position","fixed"),t.hide(),setTimeout(function(){t.show()},200)},drag:function(t){var n=i.find(".helper");if(n.css("position","fixed"),n.css("left",t.pageX-n.width()/2+"px"),n.css("top",t.pageY-n.height()/2+"px"),n.hover()){var o=t.pageY-$("#gridster2").offset().top-10,s=Math.ceil(o/25);1>s&&(s=1),e.request("addAppletPlaceholder",{hoverOverRow:s})}},stop:function(t,i){var n=t.pageX-$("#gridster2").offset().left-50,o=t.pageY-$("#gridster2").offset().top-10;e.request("addAppletToGridster",{appletId:$(this).attr("data-appletid"),appletTitle:$(this).text(),sizeX:4,sizeY:4,xPos:n,yPos:o})}})},getPaginationHtml:function(e){for(var t="",i=0;e>i;i++)t+=0===i?'<li data-target="#applets-carousel" data-slide-to="0" class="active"></li>':'<li data-target="#applets-carousel" data-slide-to="'+i+'"></li>';return t},getAppletItemsHtml:function(t,i){var n="",o=1,s=1;return t.length>0&&(n='<div class="item active">'),e.each(t.models,function(e){o%i===1&&1!==o&&(n+='<div class="item">');var t=s%(i+1)*87-50+"px";n+='<div class="applet-thumbnail" tabindex=0 data-appletid="'+e.get("id")+'" style="left: '+t+';"><p>'+e.get("title")+"</p></div>",o%i===0&&(n+="</div>",s=0),o++,s++}),n+="</div>"},filterApplets:function(t){this.collection.reset(e.filter(this.collectionOrig.models,function(e){return e.get("title").toLowerCase().indexOf(t.toLowerCase())>=0})),this.setModel(),this.render()}});return s});
define(["backbone","marionette","jquery","handlebars"],function(e,t,i,r){function n(e,t,i){return this.fromDate=t,this.toDate=i,self=this,_.filter(e.models,function(e){var t=moment(e.get("dateTime"),"YYYYMMDDHHmm");return moment(this.fromDate||"01/01/1900")<=t&&t<=moment(this.toDate||"01/01/2999")},self)}function o(e){return e.forEach(function(e){e.set({formatteddateTime:moment(e.get("dateTime"),"YYYYMMDDHHmm").format("MM/DD/YYYY HH:mm")})}),e}function c(e){return e.forEach(function(e){e.set({id:e.get("uid"),formatteddateTime:moment(e.get("dateTime"),"YYYYMMDDHHmm").format("MM/DD/YYYY HH:mm")})}),e}function s(e){var t=[{pickList:[{}]}],i=e.map(function(e){return{label:e.get("name"),value:e.get("uid")}});return t[0].pickList=i,t}function a(e){var t=[{pickList:[{}]}],i=e.map(function(e){return{label:e.get("name"),value:e.get("code")}});return t[0].pickList=i,t}var u={getServiceCategory:function(e,t,i){var r={resourceTitle:"visit-service-category",onSuccess:i,criteria:{locationIEN:e,patientStatus:t}};ADK.ResourceService.fetchCollection(r)},getProviders:function(e){var t=ADK.UserService.getUserSession().get("site"),i={resourceTitle:"visits-providers",onSuccess:e,criteria:{"facility.code":t}};ADK.ResourceService.fetchCollection(i)},getProvidersPicklist:function(t){var i=new e.Collection,r=ADK.UserService.getUserSession().get("site");i.url="/resource/write-pick-list?type=new-persons&new-persons-type=PROVIDER&site="+r,i.fetch({success:t})},getLocations:function(e){var t=ADK.UserService.getUserSession().get("site"),i={};i.resourceTitle="locations-clinics",i.onSuccess=e,i.criteria={"site.code":t},ADK.ResourceService.fetchCollection(i)},getAdmissions:function(e){var t={patient:ADK.PatientRecordService.getCurrentPatient(),resourceTitle:"visits-admissions",criteria:{},onSuccess:e};return ADK.PatientRecordService.fetchCollection(t)},getAppointments:function(e,t){var i={patient:ADK.PatientRecordService.getCurrentPatient(),resourceTitle:"visits-appointments",criteria:{filter:'like(locationUid, "%'+e+'%")'},onSuccess:t};return ADK.PatientRecordService.fetchCollection(i)},providerParser:a,locationsParser:s,admissionsParser:o,appointmentsParser:c,collectionDateFilter:n};return u});
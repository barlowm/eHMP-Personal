define(["underscore","handlebars"],function(e,t){var i={generate:function(i,o,l,n,a,d){var r=Backbone.Marionette.ItemView.extend({template:t.compile("{{"+n+"}}"),tagName:"li",className:"list-group-item",model:l.model,attributes:function(){return{id:this.model.cid,role:"menuitem",tabindex:-1,"data-name":this.model.get(n)}}}),s=Backbone.Marionette.CompositeView.extend({template:t.compile('<label for="'+i+'">'+o+'</label><input class="form-control" autocomplete="off" id="'+i+'" value="{{'+n+'}}"/><div id="'+i+'-typeahead-list"><ul role="menu" class="list-group"></ul></div><div id="'+i+'-error"></div>'),model:d,childViewContainer:"ul",childView:r,events:function(){var e={};return e["keyup #"+i]="searchItems",e["keyup ul"]="searchItems",e["click li"]="setModel",e["blur #"+i]="clearModelIfEmpty",e["keydown li"]="handleItemKeyPress",e},searchItems:function(e){38===e.keyCode||40===e.keyCode?this.handleArrowSelection(e):9!==e.keyCode&&(this.model=void 0,this.performActionWhileTyping(e,"keyup",2,500,this.handleTextEntered,this))},handleItemKeyPress:function(e){e.preventDefault(),e.stopPropagation(),(13===e.keyCode||32===e.keyCode)&&this.setModel(e)},setModel:function(e){var t=e.target.id,o=this.collection.get(t);o.get("isLoading")||(this.model=o,this.render(),this.collection.reset(),this.trigger("selected_typeahead:"+i));var l=$(document).find("a, button, :input, [tabindex]"),n=$("#"+i),a=$(l).index(n);a===l.length-1?l[0].focus():l[a+1].focus()},initialize:function(e){this.collection=new Backbone.Collection},handleTextEntered:function(e){var t=$("#"+i).val()||"";e.search(t)},performActionWhileTyping:function(t,i,o,l,n,a){if(t.type===i){var d=t.target?t.target:t.srcElement;$(d).val().length<=o&&"undefined"!=typeof timeoutHandle?(clearTimeout(timeoutHandle),this.collection.reset()):$(d).val().length>o&&("undefined"==typeof timeoutHandle?timeoutHandle=e.delay(n,l,a):(clearTimeout(timeoutHandle),timeoutHandle=e.delay(n,l,a)))}},search:function(e){l.criteria||(l.criteria={}),l.criteria[a]=e,this.collection.reset();var t=new Backbone.Model({name:"Loading...",isLoading:!0});this.collection.push(t),ADK.ResourceService.fetchCollection(l,this.collection)},clearModelIfEmpty:function(){var e=$("#"+i).val();e||(this.model=void 0)},handleArrowSelection:function(e){e.preventDefault(),e.stopPropagation();var t=$(this.el).find("li.focused");if(t[0]){t.removeClass("focused");var i;i=40===e.keyCode?t.next():$(this.el).find("li:first-child")[0].id===t[0].id?$(this.el).find("li:last-child"):t.prev(),i.addClass("focused"),i.focus()}else{e.preventDefault();var o=$(this.el).find("li:first-child");o.addClass("focused"),o.focus()}}});return s}};return i});
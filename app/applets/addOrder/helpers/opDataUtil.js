define(["jquery","jquery.inputmask","backbone","marionette","hbs!app/applets/addOrder/templates/dropdownViewTemplate","hbs!app/applets/addOrder/templates/dosageDropdownViewTemplate"],function(e,t,n,i,r,a){"use strict";var o,l=new n.Collection,s=new n.Collection,u=new n.Collection,c=new n.Model,p={patient:ADK.PatientRecordService.getCurrentPatient(),resourceTitle:"med-op-data-defaults",criteria:{},onSuccess:function(e,t){for(var n=e.toJSON()[0],i=0;i<n.internal.AllDoses.length;++i)n.internal.AllDoses[i].price_per_dispensed_unit=n.internal.Dosage[i].price_per_dispensed_unit;l.reset(n.internal.AllDoses),s.reset(n.internal.Route),c.set(n.display)}},d={patient:ADK.PatientRecordService.getCurrentPatient(),resourceTitle:"med-op-data-schedule",criteria:{},onSuccess:function(e,t){u.reset(e.toJSON())}},g=function(e){switch(e.toLowerCase()){case"dose":return l;case"route":return s;case"name":return u;default:return}},f=function(e){return n.Marionette.ItemView.extend({initialize:function(){},getTemplate:function(){return"dose"===e?a:r},tagName:"li",className:"",templateHelpers:function(){var t={data:this.model.get(e)};return"dose"==e&&(t.unitPrice=this.model.get("price_per_dispensed_unit")),t}})},h=function(){var t={},n={dose:e("#dosage").val().toUpperCase()},i={route:e("#route").val().toUpperCase()},r={name:e("#schedule").val().toUpperCase()};return t.amount=v(n,t),t.route=e("#route").val(),s.where(i).length>0&&(t.route=m(i),t.routeIEN=s.where(i)[0].get("routeien")),t.verb=c.get("Verb")?c.get("Verb")[0].value+" ":"",t.medName=c.get("Medication")?c.get("Medication")[0].value+" ":"",t.schedule=e("#schedule").val(),u.where(r).length>0&&(t.schedule=u.where(r)[0].get("desc")||u.where(r)[0].get("name")),t.supply=e("#supply").val(),t.quantity=e("#quantity").val(),t.refills=e("#refills").val(),t.pickup=e("input[name=pickup]:checked").val(),t.priority=e("#priority").val(),t},v=function(e,t){var n,i="",r="",a=l.where(e);if(void 0!==a&&e.dose.length>0&&(t.doseString=a[0].get("dose_desc"),t.drugIEN=a[0].get("drugien"),n=t.doseString.split("&"),i=n[2],r=n[3],t.strength=n[6]+n[7]||"",n[2].length>0&&(n[3].indexOf("TABLET")>=0||n[3].indexOf("CAPSULE")>=0)))switch(n[2]){case"1":i="ONE";break;case"1.5":i="ONE-HALF";break;case"2":i="TWO";break;case"3":i="THREE"}return i+" "+r},m=function(e){var t=s.where(e)[0],n=c.get("Preposition")?c.get("Preposition")[0].value+" ":"";return n+(t.get("outpatient_expansion")||t.get("route"))},w={setMed:function(e){o=e},getMed:function(){return o},getPreviewValues:function(){return h()},getCollection:function(e){return g(e)},fetchOpData:function(e){var t=ADK.PatientRecordService.getCurrentPatient().get("localId"),n={dfn:t};d.criteria.param=JSON.stringify(n),n={oi:o.get("IEN"),pstype:"X",orvp:t,needpi:"Y",pkiactiv:"Y"},p.criteria.param=JSON.stringify(n),ADK.PatientRecordService.fetchCollection(p),ADK.PatientRecordService.fetchCollection(d)},getComboBoxView:function(e){return n.Marionette.CollectionView.extend({initialize:function(){this.collection=g(e)},childView:f(e),tagName:"ul",className:"nav nav-pills nav-stacked",attributes:{},onRender:function(){this.applyInputMasking(),this.populateDefaults()},applyInputMasking:function(){},populateDefaults:function(){console.log("default display.Route = "+c.get("Route")),console.log("default display.Schedule = "+c.get("Schedule"))}})},getDoseComboBoxView:function(){}};return w});
define(["backbone","marionette","underscore","hbs!app/applets/consults/modal/modalTemplate","app/applets/documents/docUtils"],function(e,t,i,s,o){"use strict";function r(e){var t={parse:function(t){return t.activity&&o.hasDocIdRecord(t.activity,e)?(a.set(t),t):void 0}};return t}var l=e.Model.extend({setAttrsFromSummaryModel:function(e){e&&this.set({summaryLocalTitle:e.get("localTitle"),summaryKind:e.get("kind"),summaryEntered:e.get("entered"),summaryAuthorDisplayName:e.get("authorDisplayName"),summaryStatusDisplayName:e.get("statusDisplayName"),summaryText:o.getSummaryModelText(e)})}}),a=new l;return e.Marionette.ItemView.extend({template:s,model:l,initialize:function(e){this.filterDocId=e&&e.filterDocId,this.summaryModel=e&&e.summaryModel,e.resourceTitle&&(this.resourceTitle=e.resourceTitle),a.setAttrsFromSummaryModel(this.summaryModel),this.model=a;var t={};t.resourceTitle=this.resourceTitle,t.viewModel=r(this.filterDocId),this.collection=ADK.PatientRecordService.fetchCollection(t),this.listenTo(this.collection,"sync",this.collectionSynced)},collectionSynced:function(){this.model.set(a),this.render(),$("#consultsLoadingDiv").fadeOut(1e3)}})});
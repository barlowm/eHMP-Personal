define(["backbone","marionette","underscore","app/applets/patient_search/views/common/searchResultsCollectionView","hbs!app/applets/patient_search/templates/myCPRSList/myCPRSListResultsTemplate"],function(e,t,i,s,r){var n="myCprsList",a="MMDDYYYYHHmmss",o="mySite",l="myCprsList",c="none",p="No patient record found. Please make sure your CPRS Default Search is configured properly.",h=e.Marionette.LayoutView.extend({events:{"click #myCprsList":"displayTab"},searchApplet:void 0,template:r,regions:{myCPRSSearchResultsRegion:"#my-cprs-search-results"},initialize:function(e){this.searchApplet=e.searchApplet},onRender:function(){this.executeSearch()},displayErrorMessage:function(e){var t=new s({searchApplet:this.searchApplet,templateName:n});t.setEmptyMessage(e),this.myCPRSSearchResultsRegion.show(t)},displayTab:function(){patientsView.searchApplet.searchMainView.changeView(o,l)},executeSearch:function(e){var t=new s({searchApplet:this.searchApplet,templateName:n});this.myCPRSSearchResultsRegion.show(t);var i={defaults:{ageYears:"Unk"}},r={resourceTitle:"search-default-search",viewModel:i,cache:!1};r.onError=function(e,i){t.setEmptyMessage("Unknown error."),t.render()},r.onSuccess=function(e){0===l.length?(t.setEmptyMessage(p),t.searchApplet.searchMainView.changeView(o,c)):(l.comparator=function(e,t){var i=moment(e.attributes.appointment,a,!0),s=moment(t.attributes.appointment,a,!0);return i.isBefore(s)?-1:i.isSame(s)?0:1},l.sort(),t.collection=l,t.originalCollection=l),t.render()};var l=ADK.ResourceService.fetchCollection(r)},refineSearch:function(t){if(this.clearErrorMessage(),void 0!==t&&""!==t){var s=this;this.patientsView.collection=(new e.Collection).reset(i.filter(this.patientsView.originalCollection.models,function(e){return s.modelAttributeContainsFilterString(e,"fullName",t)?e:s.modelAttributeContainsFilterString(e,"ssn",t)?e:s.modelAttributeContainsFilterString(e,"birthDate",t)?e:void 0})),0===this.patientsView.collection.length&&this.displayErrorMessage(p)}else this.patientsView.collection=this.patientsView.originalCollection;this.patientsView.render()},modelAttributeContainsFilterString:function(e,t,i){return void 0!==e.attributes[t]&&e.attributes[t].toLowerCase().indexOf(i.toLowerCase())>=0?!0:!1}});return h});
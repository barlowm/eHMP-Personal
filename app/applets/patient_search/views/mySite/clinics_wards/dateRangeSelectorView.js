define(["jquery","jquery.inputmask","bootstrap-datepicker","moment","backbone","marionette","underscore","hbs!app/applets/patient_search/templates/mySite/clinics_wards/dateRangeSelectorTemplate"],function(e,t,i,a,r,d,n,s){var c="YYYYMMDD",o=r.Model.extend({defaults:{"date.start":a().format("YYYYMMDD"),"date.end":a().format("YYYYMMDD")}}),l=r.Marionette.ItemView.extend({fetchOptions:{},model:new o,template:s,className:"grid-filter-daterange",events:{"click button":"clickPresetRange","keydown input":"handleEnterOrSpaceBar","blur input":"monitorCustomDateRange"},initialize:function(e){this.parent=e.parent},monitorCustomDateRange:function(e){var t=a(this.$el.find("#filter-from-date-clinic").val(),"MM/DD/YYYY",!0),i=a(this.$el.find("#filter-to-date-clinic").val(),"MM/DD/YYYY",!0);t.isValid()&&i.isValid()&&t.isBefore(i)?(this.model.set("date.start",t.format(c)),this.model.set("date.end",i.format(c)),this.$el.find("#custom-range-apply").removeAttr("disabled"),this.$el.find("button").removeClass("active-range")):this.$el.find("#custom-range-apply").prop("disabled",!0)},isCustomDateRangeValid:function(){var e=!1,t=this.$el.find("#filter-from-date-clinic").val(),i=this.$el.find("#filter-to-date-clinic").val(),r=a(t,"MM/DD/YYYY",!0),d=a(i,"MM/DD/YYYY",!0);return r.isValid()&&d.isValid()&&r.isBefore(d)&&(this.model.set("date.start",a(t,"MM/DD/YYYY").format(c)),this.model.set("date.end",a(i,"MM/DD/YYYY").format(c)),e=!0),e},handleEnterOrSpaceBar:function(t){var i=t&&t.which?t.which:t.keyCode,a=13,r=32;if(i!==a&&i!==r&&e("[id^=custom-date-]").datepicker("hide"),i==a||i==r){var d=this.$el.find("#"+t.currentTarget.id);d.focus(),d.trigger("click")}},clickPresetRange:function(e){this.$el.find("button").removeClass("active-range"),this.$el.find("#"+e.currentTarget.id).addClass("active-range");var t,i,r=a().format(c);switch(-1!==e.currentTarget.id.indexOf("-clinicDate")&&-1===e.currentTarget.id.indexOf("custom-range-apply")&&(this.$el.find("#filter-from-date-clinic").val(""),this.$el.find("#filter-to-date-clinic").val(""),this.$el.find("#custom-range-apply").prop("disabled",!0)),e.currentTarget.id){case"past-month-clinicDate":t=a().subtract("months",1).format(c),i=r;break;case"past-week-clinicDate":t=a().subtract("days",7).format(c),i=r;break;case"yesterday-clinicDate":t=a().subtract("days",1).format(c),i=r;break;case"today-clinicDate":t=r,i=r;break;case"tomorrow-clinicDate":t=r,i=a().add("days",1).format(c);break;case"next-week-clinicDate":t=r,i=a().add("days",7).format(c);break;default:t=this.model.get("date.start"),i=this.model.get("date.end")}if(this.setDateRange(t,i),this.parent.selectedLocationModel){var d={"ref.id":this.parent.selectedLocationModel.attributes.refId,uid:this.parent.selectedLocationModel.attributes.uid};this.parent.executeSearch(d)}},setDateRange:function(e,t){this.model.set({"date.start":e,"date.end":t})},setDatePickers:function(t,i){this.$(".input-group.date#custom-date-from-clinic").datepicker({format:"mm/dd/yyyy"}).on("changeDate",function(t){e(this).datepicker("hide"),e(e(this).context.lastElementChild).focus()}),null!==t&&this.$(".input-group.date#custom-date-from-clinic").datepicker("update",t),this.$(".input-group.date#custom-date-to-clinic").datepicker({format:"mm/dd/yyyy"}).on("changeDate",function(t){e(this).datepicker("hide"),e(e(this).context.lastElementChild).focus()}),null!==i&&this.$(".input-group.date#custom-date-to-clinic").datepicker("update",i),this.$("#filter-from-date-clinic").datepicker("remove"),this.$("#filter-to-date-clinic").datepicker("remove")},onRender:function(e){this.$("#filter-from-date-clinic").inputmask("m/d/y",{placeholder:"MM/DD/YYYY"}),this.$("#filter-to-date-clinic").inputmask("m/d/y",{placeholder:"MM/DD/YYYY"});var t=this.model.get("selectedId"),i=this.model.get("customFromDate"),a=this.model.get("customToDate");if(void 0!==t&&null!==t)this.setDatePickers(i,a),this.$el.find("#"+t).click();else{var r=ADK.SessionStorage.getModel("globalDate");t=r.get("selectedId"),this.model.set("selectedId",t),this.setDatePickers(i,a)}}});return l});
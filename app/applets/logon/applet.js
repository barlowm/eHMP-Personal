define(["backbone","handlebars","hbs!app/applets/logon/templates/main","app/applets/logon/facilityListView"],function(e,r,s,i){var a=e.Marionette.LayoutView.extend({template:s,regions:{facilityListRegion:"#authenication-facility-list"},events:{submit:"login","propertychange .form-group":"clearErrors","change .form-group":"clearErrors","input .form-group":"clearErrors","paste .form-group":"clearErrors"},onShow:function(){this.facilityListView=new i({parentView:this}),this.facilityListRegion.show(this.facilityListView)},clearErrors:function(){this.$el.find("form").hasClass("has-error")&&this.$el.find("form").removeClass("has-error"),this.$el.find("#errorMessage").hasClass("alert-info")&&this.$el.find("#errorMessage").removeClass("alert-info text-info"),this.$el.find("#errorMessage").empty()},login:function(e){e.preventDefault();var r=this.$el.find("#login");r.button("loading"),this.$el.find("#screenReaderAuthenticating").addClass("sr-only").removeClass("hidden").focus();var s={facility:this.$el.find("form #facility")[0].value,accessCode:this.$el.find("form #accessCode")[0].value,verifyCode:this.$el.find("form #verifyCode")[0].value};if(s.facility&&s.accessCode&&s.verifyCode&&"noneSelected"!==s.facility){var i=function(){ADK.ADKApp.initAllRouters(),ADK.Navigation.navigate(ADK.ADKApp.userSelectedDefaultScreen)},a=this,t=function(e){if(window.console&&window.console.log&&console.log("Error logging in",e),e)switch(e.status){case 401:if(e.responseText){var s=$.parseJSON(e.responseText);s.message?s=s.message:s.errorMessage&&(s=s.errorMessage),a.$el.find("#errorMessage").html(s)}else a.$el.find("#errorMessage").html("Authentication error.");a.$el.find("form").addClass("has-error");break;case 403:a.$el.find("#errorMessage").html("User is not authorized to access this system."),a.$el.find("form").addClass("has-error");break;case 503:a.$el.find("#errorMessage").html("SYNC NOT COMPLETE. Please try again in a few minutes."),a.$el.find("#errorMessage").addClass("alert-info text-info");break;default:a.$el.find("#errorMessage").html("Unable to login due to server error. Status code: "+e.status),a.$el.find("form").addClass("has-error")}else a.$el.find("#errorMessage").html("Authentication error."),a.$el.find("form").addClass("has-error");r.button("reset")},o=ADK.UserService.authenticate(s.accessCode,s.verifyCode,s.facility);o.done(i).fail(t)}else this.$el.find("form").addClass("has-error"),this.$el.find("#errorMessage").html("Please ensure all fields have been entered"),r.button("reset")}}),t={id:"logon",getRootView:function(){return a}};return t});
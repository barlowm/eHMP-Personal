define(["backbone","marionette","underscore","hbs!app/applets/addVitals/templates/addVitalsTemplate","hbs!app/applets/addVitals/templates/visitRegionTemplate","hbs!app/applets/addVitals/templates/footerTemplate","app/applets/addVitals/dateTimeView","app/applets/addVitals/vitalsCollectionView","app/applets/addVitals/utils/modelUtils","app/applets/addVitals/utils/dateTimeUtil","app/applets/addVitals/utils/saveUtil","app/applets/addVitals/utils/viewHelper"],function(e,t,i,a,s,l,n,o,r,d,c,p){"use strict";var m,u,h="addVitalsRequestChannel",g="addVitalsModal",v="visit",V="changeVisit",f="addVitals",w="set-visit-success:addVitals",b=r,E=p,M=c,q=ADK.Messaging.getChannel(v),R=e.Marionette.ItemView.extend({template:l,events:{"click #btn-add-vital-accept":function(e){this.clearErrors(e),this.addVitals(e)},"click button[data-dismiss='modal']":"clearErrors","click #visit-btn":"selectVisit"},clearErrors:function(){b.errorView.clearErrors()},addVitals:function(e){e.preventDefault(),$("#btn-add-vital-accept").html("<i class='fa fa-spinner fa-spin'></i> <span> Saving...</span>"),$("#btn-add-vital-accept").addClass("disabled").attr("disabled"),M.save(b.getVitalsModel(),u)}}),T=e.Marionette.ItemView.extend({tagName:"div",template:s,initialize:function(){var e=this.model.get("visit");if(e){var t=e.locationUid;if(t){var i=t.split(":").pop();b.getVitalsModel().setLocation(i)}}}});return e.Marionette.LayoutView.extend({className:"add-vitals-styles",template:a,events:{"click #add-vital-visit-btn":"selectVisit"},regions:{visitRegion:"#visit-region",dateTimeRegion:"#date-time-region",vitalsRegion:"#vitals-tbl-container",errorRegion:"#error-container"},initialize:function(){b.initVitalsModel(),this.model=b.getVitalsModel(),this.items=this.model.get("items"),b.errorView=new ADK.Views.ServerSideError;var e=this;this.items.bind("change:error",function(t,i){e.model.updateError(t.get("sname"),t.isError())}),this.items.bind("change:min-reqs",function(t,i){e.model.updateVitalMinReqs(t.get("sname"),t.hasMinReqs())}),this.items.bind("change:qual-1-error",function(t,i){e.model.updateError(t.get("sname")+"-qual-1",t.isQual1Error())}),this.items.bind("change:qual-2-error",function(t,i){e.model.updateError(t.get("sname")+"-qual-2",t.isQual2Error())}),this.items.bind("change:qual-3-error",function(t,i){e.model.updateError(t.get("sname")+"-qual-3",t.isQual3Error())}),this.items.bind("change:qual-4-error",function(t,i){e.model.updateError(t.get("sname")+"-qual-4",t.isQual4Error())}),this.listenTo(this.model,"change:min-reqs",this.toggleSave)},onRender:function(){this.updateVisit();var e=new n({model:this.model});this.dateTimeView=e,this.dateTimeRegion.show(e);var t=new o({collection:this.items});this.vitalsView=t,this.vitalsRegion.show(t),this.errorRegion.show(b.errorView)},selectVisit:function(){m=this,q.command(V,f,{channel:h,command:g,callback:m.showModal}),q.on(w,function(){m.updateVisit()})},updateVisit:function(){var e=new T({model:b.getVisitModel()});this.visitView=e,this.visitRegion.show(e)},toggleSave:function(){this.model.get("min-reqs")?E.enableItem($("#btn-add-vital-accept"),!0):E.enableItem($("#btn-add-vital-accept"),!1)},showModal:function(e,t){ADK.PatientRecordService.getCurrentPatient();u=t;var i={title:"Add Vital Signs",size:"medium",footerView:R,regionName:"addVitalsDialog"},a=new ADK.UI.Modal({view:this,options:i});a.show()}})});
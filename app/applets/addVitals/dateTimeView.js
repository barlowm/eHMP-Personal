define(["backbone","marionette","underscore","hbs!app/applets/addVitals/templates/dateTimeRegionTemplate","app/applets/addVitals/utils/modelUtils","app/applets/addVitals/utils/dateTimeUtil","app/applets/addVitals/utils/viewHelper","moment"],function(e,t,a,i,s,n,d,l){"use strict";var o,r=n,p=d;return e.Marionette.ItemView.extend({tagName:"div",template:i,events:{"click #patient-on-pass-btn":"handleClick","blur #vitals-obs-date":"dateEntered","blur #vitals-obs-time":"timeEntered","change #vitals-obs-date":"dateFieldChanged"},initialize:function(){this.listenTo(this.model,"change:on-pass",this.togglePoP),this.listenTo(this.model,"change:date-time-error",this.dateTimeErrorChange)},onRender:function(){var e=r.currentObservedDateString(),t=r.currentObservedTimeString();this.model.setDate(e),this.model.setTime(t);var a=this;setTimeout(function(){var e=$("#vitals-obs-date"),i=(new l).format(ADK.utils.dateUtils.defaultOptions().endDate);ADK.utils.dateUtils.datepicker(e,{endDate:i}),e.datepicker("update",i),e.datepicker().on("changeDate",function(e){a.model.setDate(r.getDateString(e.date))}),e.parent().find(".glyphicon-calendar").on("click",function(){e.datepicker("show")}),$("#vitals-obs-time").inputmask("Regex",{placeholder:"hh:mm a/p"}),$("#vitals-obs-time").val(t)},100)},dateFieldChanged:function(){o="date";var e=$("#vitals-obs-date").val();e?this.model.setDate(e):$("#vitals-obs-date").val(this.model.getDate())},dateEntered:function(){o="date";var e=$("#vitals-obs-date").val();e?this.model.setDate(e):$("#vitals-obs-date").val(this.model.getDate())},timeEntered:function(){o="time",this.model.setTime($("#vitals-obs-time").val())},dateTimeErrorChange:function(){var e=this.model.getDateTimeError(),t="date"===o?$("#vitals-date-err"):$("#vitals-time-err");e?(t.attr("aria-hidden","false"),t.text(e),$("#patient-on-pass-btn").prop("disabled",!0)):(t.attr("aria-hidden","true"),t.text(""),$("#patient-on-pass-btn").prop("disabled",!1))},enablePoP:function(){$("#patient-on-pass-btn").prop("disabled",!this.model.hasValidDateTime())},togglePoP:function(){p.selectBtn($("#patient-on-pass-btn"),this.model.get("on-pass"))},handleClick:function(e){e.preventDefault(),this.model.toggleOnPass()}})});
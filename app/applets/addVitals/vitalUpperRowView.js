define(["backbone","marionette","underscore","hbs!app/applets/addVitals/templates/upperVitalRowTemplate","app/applets/addVitals/utils/modelUtils","app/applets/addVitals/utils/dateTimeUtil","app/applets/addVitals/utils/viewHelper"],function(e,t,a,s,l,i,n){"use strict";var d=n;return e.Marionette.ItemView.extend({tagName:"div",getTemplate:function(){return s},events:{"click .btn":"handleClick","blur input":"handleInput","change select":"handleSelect"},initialize:function(){this.listenTo(this.model,"change:unavailable",this.toggleUR),this.listenTo(this.model,"change:refused",this.toggleUR),this.listenTo(this.model,"change:sel-unit-name",this.toggleUnit),this.listenTo(this.model,"change:on-pass",this.toggleOnPass),this.listenTo(this.model,"change:reading",this.updateReading),this.listenTo(this.model,"change:error",this.updateError),this.listenTo(this.model,"change:refused-label",this.updateRefusedLabel),this.listenTo(this.model,"change:unavailable-label",this.updateUnavailableLabel)},onRender:function(){$("#"+this.model.get("sname")+"-hide-show").removeClass("show"),$("#"+this.model.get("sname")+"-hide-show").addClass("hide"),this.model.get("mask")&&(this.model.get("regex")?this.$el.find("#"+this.model.get("sname")+"-reading").inputmask("Regex",{regex:this.model.get("mask")}):this.$el.find("#"+this.model.get("sname")+"-reading").inputmask(this.model.get("mask")))},handleInput:function(e){e.preventDefault(),"reading"===$(e.target).data("type")&&this.model.setReading($(e.target).val())},handleSelect:function(e){if(e.preventDefault(),"reading"===$(e.target).data("type")){var t=$(e.target).find(":selected").val(),a=t.split(" ")[0];this.model.setReading(a)}},updateReading:function(){var e=this.model.getReading();"pa"!==this.model.get("sname")&&$("#"+this.model.get("sname")+"-reading").val(e)},updateError:function(){var e=this.model.get("error");e?d.showError(this.model.get("sname"),this.model.get("hint")):d.hideError(this.model.get("sname"))},handleClick:function(e){e.preventDefault();var t=$(e.target).data("type");"qualifier"===t?this.handleQualifierClick(e):"u-r"===t?this.model.toggleURAttribute($(e.target).data("subtype")):"unit"===t&&this.model.toggleUnit($(e.target).data("value"))},toggleOnPass:function(){var e=this.model.get("on-pass");d.enableRow(this.model.get("sname")+"-",!e),e&&($("#"+this.model.get("sname")+"-hide-show").removeClass("show"),$("#"+this.model.get("sname")+"-hide-show").addClass("hide"),d.selectBtn($("#"+this.model.get("sname")+"-q-btn"),!1))},toggleUnit:function(){var e=this.model.get("sel-unit-name"),t=this.model.get("sname"),a=$("#"+t+"-u1-btn"),s=$("#"+t+"-u2-btn"),l=this.model.get("unit-1-name"),i=this.model.get("unit-2-name");d.updateLabel($("#"+t+"-reading"),this.model.get("name")+" "+e),a.data("value")===e?(d.selectBtn(a,!0,l),d.selectBtn(s,!1,i)):(d.selectBtn(s,!0,i),d.selectBtn(a,!1,l))},toggleUR:function(){var e=this.model.get("unavailable"),t=this.model.get("refused"),a=$("#"+this.model.get("sname")+"-u-btn"),s=$("#"+this.model.get("sname")+"-r-btn"),l=this.model.get("sname"),i=$("#"+this.model.get("sname")+"-q-btn"),n="toggle"===i.data("disabled");d.enableInputs(l+"-",!0),d.enableUnits(l,!0),n&&d.enableItem($("#"+l+"-q-btn"),!0),d.selectBtn($("#"+l+"-q-btn"),!1),(e||t)&&(this.model.set("sel-unit-name",this.model.get("unit-1-name")),d.hideError(l),d.enableUnits(l,!1),d.resetRowQualifierInputs(l),$("#"+l+"-hide-show").removeClass("show"),$("#"+l+"-hide-show").addClass("hide"),d.enableItem($("#"+l+"-q-btn"),!1),d.enableInputs(l+"-",!1)),e?(d.selectBtn(a,!0),d.selectBtn(s,!1)):d.selectBtn(a,!1),t?(d.selectBtn(s,!0),d.selectBtn(a,!1)):d.selectBtn(s,!1)},updateRefusedLabel:function(){var e=this.model.get("refused-label");$("#"+this.model.get("sname")+"-r-btn").attr("aria-label",e)},updateUnavailableLabel:function(){var e=this.model.get("unavailable-label");$("#"+this.model.get("sname")+"-u-btn").attr("aria-label",e)},handleQualifierClick:function(){var e=$("#"+this.model.get("sname")+"-q-btn"),t=$("#"+this.model.get("sname")+"-hide-show");d.isSelected(e)?(d.selectBtn(e,!1),t.removeClass("show"),t.addClass("hide")):(d.selectBtn(e,!0),t.removeClass("hide"),t.addClass("show"))}})});
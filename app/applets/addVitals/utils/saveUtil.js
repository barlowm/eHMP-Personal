define(["backbone","marionette","underscore","moment","app/applets/addVitals/utils/modelUtils","app/applets/addVitals/utils/dateTimeUtil"],function(e,t,i,a,s,l){"use strict";var n,r=s,o=l,g=e.Model.extend({urlRoot:"",defaults:{dfn:"",locIEN:"",dateTime:"",vitals:{}}}),u={error:function(e,t){console.log("error"),console.log(t),r.errorView.addError(t.responseText,"Save Failed")},success:function(e,t){console.log("success"),ADK.UI.Modal.hide(),setTimeout(function(){ADK.Messaging.getChannel("vitals").request("refreshGridView")},2e3)}},d=function(e){var t=new g,i=ADK.PatientRecordService.getCurrentPatient();t.set("dfn",e.get("dfn")),t.set("duz",i.get("pid")),t.set("locIEN",e.get("locIEN"));var a=o.getSaveDate(e.getDate(),e.getTime());t.set("dateTime",a);var s=e.get("on-pass"),l=[];e.get("items").each(function(e){if(s)l.push({fileIEN:e.getFileIEN(),reading:"Pass"});else if(e.isRefused())l.push({fileIEN:e.getFileIEN(),reading:"Refused"});else if(e.isUnavailable())l.push({fileIEN:e.getFileIEN(),reading:"Unavailable"});else if(e.get("min-reqs"))if("po"===e.get("sname")){var t=e.get("qual-1-val"),i=e.get("qual-2-val"),a={};a.fileIEN=e.getFileIEN(),a.reading=e.getReading(),t&&(a.flowRate=t),i&&(a.o2Concentration=i),a.qualifiers=e.getQualifiers(),l.push(a)}else l.push({fileIEN:e.getFileIEN(),reading:e.getReading(),unit:e.getUnit(),qualifiers:e.getQualifiers()})});var n="";return n=i.get("icn")?i.get("icn"):i.get("pid")?i.get("pid"):i.get("id"),t.set("vitals",l),t.urlRoot=ADK.ResourceService.buildUrl("write-back-save-vitals",{pid:n}),console.log(JSON.stringify(t)),t},f=function(e){var t=d(e);t.save(null,u)},c={save:function(e,t){n=t,f(e)},dummySave:function(e,t){t.error(e,"this is a test")}};return c});
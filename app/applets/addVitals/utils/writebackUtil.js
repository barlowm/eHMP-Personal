define(["backbone"],function(e){var t=e.Model.extend({sync:function(e,t,a){var i={type:"POST",url:t.url(),contentType:"application/json",data:JSON.stringify(t.toJSON()),dataType:"json"};$.ajax(_.extend(i,a))},url:function(){var e=ADK.PatientRecordService.getCurrentPatient().get("pid");return"resource/write-health-data/patient/"+e+"/vitals"}}),a={buildSaveVitalsModel:function(e,a,i,p){var u=new t,l=p.get("visit"),n=moment(e.get("dateTakenInput"),"MM/DD/YYYY").format("YYYYMMDD"),o=e.get("time-taken");o&&(o=o.replace(":",""),n+=o),u.set("dateTime",n);var s=p.get("pid").split(";")[1];u.set("dfn",s),l&&u.set("locIEN",l.uid);var r=i.get("duz")[i.get("site")]?i.get("duz")[i.get("site")]:i.get("duz")[0];u.set("enterdByIEN",r);var g=[];return(e.get("facility-name-pass-po")||e.get("bpInputValue")||e.get("bp-unavailable-po")||e.get("bp-refused-po"))&&g.push(this.buildVital(e,"bpInputValue",a,"BLOOD PRESSURE",[],["bp-cuff-size-po","bp-location-po","bp-method-po","bp-position-po"],"bp-refused-po","bp-unavailable-po")),(e.get("facility-name-pass-po")||e.get("pulseInputValue")||e.get("pulse-unavailable-po")||e.get("pulse-refused-po"))&&g.push(this.buildVital(e,"pulseInputValue",a,"PULSE",[],["pulse-location-po","pulse-method-po","pulse-position-po","pulse-site-po"],"pulse-refused-po","pulse-unavailable-po")),(e.get("facility-name-pass-po")||e.get("respirationInputValue")||e.get("respiration-unavailable-po")||e.get("respiration-refused-po"))&&g.push(this.buildVital(e,"respirationInputValue",a,"RESPIRATION",[],["respiration-method-po","respiration-position-po"],"respiration-refused-po","respiration-unavailable-po")),(e.get("facility-name-pass-po")||e.get("temperatureInputValue")||e.get("temperature-unavailable-po")||e.get("temperature-refused-po"))&&g.push(this.buildVital(e,"temperatureInputValue",a,"TEMPERATURE",["F","C"],["temperature-location-po"],"temperature-refused-po","temperature-unavailable-po")),(e.get("facility-name-pass-po")||e.get("O2InputValue")||e.get("po-unavailable-po")||e.get("po-refused-po"))&&g.push(this.buildVital(e,"O2InputValue",a,"PULSE OXIMETRY",[],["po-method-po"],"po-refused-po","po-unavailable-po")),(e.get("facility-name-pass-po")||e.get("heightInputValue")||e.get("height-unavailable-po")||e.get("height-refused-po"))&&g.push(this.buildVital(e,"heightInputValue",a,"HEIGHT",["in","cm"],["height-quality-po"],"height-refused-po","height-unavailable-po")),(e.get("facility-name-pass-po")||e.get("weightInputValue")||e.get("weight-unavailable-po")||e.get("weight-refused-po"))&&g.push(this.buildVital(e,"weightInputValue",a,"WEIGHT",["lb","kg"],["weight-method-po","weight-quality-po"],"weight-refused-po","weight-unavailable-po")),(e.get("facility-name-pass-po")||e.get("pain-value-po")||e.get("pain-unavailable-po")||e.get("pain-refused-po")||e.get("pain-checkbox-po"))&&g.push(this.buildVital(e,"pain-value-po",a,"PAIN",[],[],"pain-refused-po","pain-unavailable-po")),(e.get("facility-name-pass-po")||e.get("circumValue")||e.get("cg-unavailable-po")||e.get("cg-refused-po"))&&g.push(this.buildVital(e,"circumValue",a,"CIRCUMFERENCE/GIRTH",["cm","in"],["cg-site-po","cg-location-po"],"cg-refused-po","cg-unavailable-po")),u.set("vitals",g),u},addVitals:function(e,t,a,i){var p=ADK.PatientRecordService.getCurrentPatient(),u=ADK.UserService.getUserSession(),l=this.buildSaveVitalsModel(e,t,u,p);l.save(null,{success:function(){a()},error:function(e,t){i()}})},buildVital:function(e,t,a,i,p,u,l,n){var o={};if(e.get("facility-name-pass-po"))o.reading="Pass";else if(e.get(l))o.reading="Refused";else if(e.get(n))o.reading="Unavailable";else{var s=e.get(t);p&&p.length>0&&_.each(p,function(e){var t=s.substring(s.length-e.length,s.length);t===e&&(o.unit=t,s=s.substring(0,s.length-e.length))}),"pain-value-po"===t&&e.get("pain-checkbox-po")&&(s="99 - Unable to Respond"),o.reading=s;var r=[];_.each(u,function(t){var a=e.get(t);a&&r.push(a)}),o.qualifiers=r,"O2InputValue"===t&&e.get("suppO2InputValue")&&(o.flowRate=e.get("suppO2InputValue"))}return o.fileIEN=a[i],o}};return a});
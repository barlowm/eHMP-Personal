define(["backbone","marionette","underscore","moment"],function(e,i,t,r){var n={templateSelector:function(e){return this.isVisit(e)?this.getVisitTemplate(e):this.isImmunization(e)?"immunizationTemplate":this.isSurgery(e)?"surgeryTemplate":this.isConsult(e)?"consultTemplate":this.isProcedure(e)?"procedureTemplate":this.isLaboratory(e)?"laboratoryTemplate":void 0},getVisitTemplate:function(e){return e.stopCodeName&&"emergency dept"===e.stopCodeName.toLowerCase()?"emergencyDeptTemplate":n.isHospitalization(e)?n.isDischargedOrAdmitted(e)?"dischargedPatientTemplate":"admittedPatientTemplate":e.stopCodeName?"stopCodeVisitTemplate":"defaultVisitTemplate"},getPrimaryProviderDisplay:function(e){return void 0!==e.primaryProvider?e.primaryProvider.providerDisplayName:void 0},isHospitalization:function(e){return"urn:va:encounter-category:AD"===e.categoryCode},isDischargedOrAdmitted:function(e){if(void 0===e.stay)throw"stay is required for this method!";return void 0!==e.stay.dischargeDateTime},getActivityDateTime:function(e){return this.isVisit(e)?this.isHospitalization(e)&&this.isDischargedOrAdmitted(e)?e.stay.dischargeDateTime:e.dateTime:this.isImmunization(e)?e.administeredDateTime:e.dateTime},isImmunization:function(e){return this.isKindTypeHelper(e,"immunization")},isVisit:function(e){return this.isKindTypeHelper(e,"visit")||this.isKindTypeHelper(e,"admission")||this.isKindTypeHelper(e,"dod appointment")||this.isKindTypeHelper(e,"dod encounter")},isSurgery:function(e){return this.isKindTypeHelper(e,"surgery")},isCptProcedure:function(e){return t.isUndefined(e)?!1:e.get("isCPTdomain")?this.isKindTypeHelper(e,"procedure"):!1},isConsult:function(e){return this.isKindTypeHelper(e,"consult")},isProcedure:function(e){return this.isKindTypeHelper(e,"procedure")},isLaboratory:function(e){return this.isKindTypeHelper(e,"laboratory")||this.isKindTypeHelper(e,"microbiology")},isKindTypeHelper:function(i,t){if(void 0===i)return!1;var r=i.kind;return i instanceof e.Model&&(r=i.get("kind")),void 0===r?!1:(r=r.toLowerCase(),r===t)},convertTimelineDate:function(e){return void 0!==e&&"present"!==e.toLowerCase()?r(e,"DD-MMM-YYYY").format("YYYYMMDD"):void 0},getDisplayType:function(i){if(this.isKindTypeHelper(i,"visit")){var t=i instanceof e.Model?i.get("uid"):i.uid,r=t.split(/\:/)[2];return"appointment"===r?"Appointment":"Visit"}var n=i instanceof e.Model?i.get("kind"):i.kind;return n}};return n});